# this one is called for nightly tests
ai_test_startup_effect = {
	# if = {
	# 	limit = { is_major = yes } 
	# 	#enable crypto agency in ~2.5 years
	# 	country_event = { id = generic_debug.42 days = 900 }
	# }
	# if = {
	# 	limit = { 
	# 		OR = {
	# 			tag = ENG
	# 		}
	# 	} 
	# 	#give usa access to france & england in ~4 year
	# 	country_event = { id = generic_debug.43 days = 1500 }
	# }
}

# effects that starts with name d_ will be available as console command
# use "effect_name_DESC" to define a description

d_collaboration = {
	if = {
		limit = { tag = FROM }
		log = "Error:"
		log = "  right click a country to select it for adding collaboration"
		log = "  you can specify collaboration amount to add or just use 'collaboration' to add 10%"
		log = " "
	}
	else = {
		FROM = {
			add_collaboration = { 
				target = PREV 
				value = args^0?0.1				
			}
			
			log = "Added [?args^0?0.1|H%] collaboration for [PREV.GetName]"
		}
	}
}

d_add_fake_armies = {
	if = {
		# create template if not exist
		limit = {
			not = {
				has_country_flag = fake_intel_template_created
			}
		}
		division_template = {
			name = "Fake Intel Division"
			
			is_fake_intel_division = yes
			is_locked = yes
			regiments = {
				fake_intel_unit = { x = 0 y = 0 }
			}
		}
		set_country_flag = fake_intel_template_created
	}
	
	# give it an id and store id & current date so it can be deleted later
	if = {
		limit = { NOT = { has_variable = fake_intel_id } }
		set_variable = { fake_intel_id = 1000 }
	}
	set_temp_variable = { id_to_set = fake_intel_id }
	add_to_variable = { fake_intel_id = 1 }
	add_to_array = {
		fake_intel_ids_to_delete = id_to_set
	}
	set_variable = { num_days_for_fake_intel_id@var:id_to_set = global.num_days }
	
	# minimum of 0.25 of current armies or 24
	set_temp_variable = { num_to_create = num_armies }
	multiply_temp_variable = { num_to_create = 0.25 }
	round_temp_variable = num_to_create
	add_to_temp_variable = { num_to_create = 1 }
	clamp_temp_variable = {
		var = num_to_create
		min = 24
	}
	
	# create actual units
	capital_scope = {
		create_unit = {
			division = "division_template = \"Fake Intel Division\" start_experience_factor = 0.5" 
			owner = PREV
			count = num_to_create
			id = id_to_set
		}
	}
	
	# will delete them after 90 days
	country_event = { id = lar_fake_intel_units.1 days = 90 }
	
	log = "Done"
}

#############################
### MISC CONSOLE COMMANDS ###
#############################

d_retire_country_leader = {
	random_character = {
		limit = { is_country_leader = yes }
		log = "Character [THIS.GetName] retired from [ROOT.GetNameDef]"
	}
	retire_country_leader = yes
}

d_clear_tech = {
	set_technology = { improved_infantry_weapons = 0 popup = no }
	log = "tech reset: improved_infantry_weapons"
}

d_add_tech = {
	set_technology = { improved_infantry_weapons = 1 popup = no }
	log = "tech researched: improved_infantry_weapons"
}

d_spawn_3D_models = {
	if = {
		limit = {
			NOT = { has_template = "Cavalleria Coloniale" }
		}
		division_template = {
			name = "Cavalleria Coloniale" 
			division_names_group = ITA_CAV_03
			override_model = ITA_cavalry_alt_1_entity
			is_locked = yes

			# Represents lesser-equipped colonial units
			regiments = { 
				cavalry = { x = 0 y = 0 } 
				cavalry = { x = 0 y = 1 } 
				cavalry = { x = 1 y = 0 } 
				cavalry = { x = 1 y = 1 }
			} 

			priority = 0 
		}
	}

	if = {
		limit = {
			NOT = { has_template = "Reggimento Meharista" }
		}
		division_template = {
			name = "Reggimento Meharista" 
			division_names_group = ITA_CAM_01 
			override_model = ITA_camelry_alt_2_entity
			regiments = { 
				camelry = { x = 0 y = 0 } 
				camelry = { x = 0 y = 1 } 
				camelry = { x = 1 y = 0 } 
				camelry = { x = 1 y = 1 } 
			} 
		}
	}

	if = {
		limit = {
			NOT = { has_template = "Truppe Irregolari di Cammelli" }
		}
		division_template = {
			name = "Truppe Irregolari di Cammelli"		
			division_names_group = ITA_CAM_02
			override_model = ITA_camelry_alt_3_entity
			is_locked = yes
			# Note: Represents irregular cavalry from the colonies (ascari, dubats and other "bands")
			regiments = {
				camelry = { x = 0 y = 0 }
				camelry = { x = 0 y = 1 }
			}
			priority = 0
		}
	}

	if = {
		limit = {
			NOT = { has_template = "Bersaglieri" }
		}
		division_template = { #TODO_Manu: Possibly not a real template in-game
			name = "Bersaglieri" 
			division_names_group = ITA_INF_01 
			override_model = ITA_infantry_alt_0_entity

			# Represents nearly all infantry divisions
			# In later years, CC.NN. Brigade added to INF Division (1x2 MIL/INF regiments)
			# Also represent semi-mountain divisions (1st, 2nd, 3rd, 4th, 6th Divisions)
			regiments = { 
				infantry = { x = 0 y = 0 } 
				infantry = { x = 0 y = 1 } 
				infantry = { x = 0 y = 2 } 
				
				infantry = { x = 1 y = 0 } 
				infantry = { x = 1 y = 1 } 
				infantry = { x = 1 y = 2 } 
			} 
			support = { 
				assault_engineers = { x = 0 y = 0 }
				horse_artillery = { x = 0 y = 1 }
			} 
		} 
	}

	663 = {
		#Regular Infantry
		create_unit = {
			division = "division_template = \"Divisione di Fanteria\" start_experience_factor = 0.5 start_equipment_factor = 1.0"
			owner = ROOT
			count = 1
		}

		#Mountaineer
		create_unit = {
			division = "division_template = \"Divisione Alpina\" start_experience_factor = 0.5 start_equipment_factor = 1.0"
			owner = ROOT
			count = 1
		}

		#Bersaglieri
		create_unit = {
			division = "division_template = \"Bersaglieri\" start_experience_factor = 0.5 start_equipment_factor = 1.0"
			owner = ROOT
			count = 1
		}

		#Blackshirt
		create_unit = {
			division = "division_template = \"Camicie Nere\" start_experience_factor = 0.5 start_equipment_factor = 1.0"
			owner = ROOT
			count = 1
		}

		#Colonial Infantry Eritrean
		create_unit = {
			division = "division_template = \"Eritrean Ascari\" start_experience_factor = 0.5 start_equipment_factor = 1.0"
			owner = ROOT
			count = 1
		}

		#Colonial Infantry Libyan
		create_unit = {
			division = "division_template = \"Libyan Ascari\" start_experience_factor = 0.5 start_equipment_factor = 1.0"
			owner = ROOT
			count = 1
		}

		#Colonial Infantry Somali
		create_unit = {
			division = "division_template = \"Somali Ascari\" start_experience_factor = 0.5 start_equipment_factor = 1.0"
			owner = ROOT
			count = 1
		}

		#Regular Cavalry Eritrean
		create_unit = {
			division = "division_template = \"Cavalleria Coloniale\" start_experience_factor = 0.5 start_equipment_factor = 1.0"
			owner = ROOT
			count = 1
		}

		#Regular Camelry Eritrean
		create_unit = {
			division = "division_template = \"Reggimento Meharista\" start_experience_factor = 0.5 start_equipment_factor = 1.0"
			owner = ROOT
			count = 1
		}

		#Irregular Infantry Eritrean
		create_unit = {
			division = "division_template = \"Eritrean Irregulars\" start_experience_factor = 0.5 start_equipment_factor = 1.0"
			owner = ROOT
			count = 1
		}

		#Irregular Infantry Libyan
		create_unit = {
			division = "division_template = \"Libyan Irregulars\" start_experience_factor = 0.5 start_equipment_factor = 1.0"
			owner = ROOT
			count = 1
		}

		#Irregular Cavalry Eritrean
		create_unit = {
			division = "name = \"Gruppo Bande Amhara\" division_template = \"Eritrean Irregular Cavalry\" start_experience_factor = 0.5 start_equipment_factor = 1.0"
			owner = ROOT
			count = 1
		}

		#Irregular Camelry Eritrean
		create_unit = {
			division = "division_template = \"Truppe Irregolari di Cammelli\" start_experience_factor = 0.5 start_equipment_factor = 1.0"
			owner = ROOT
			count = 1
		}
	}
}

WA_AI_logging_debug = {
	set_country_flag = WA_AI_construction_logging    # Logs railway built
	set_country_flag = WA_AI_pathfind_logging        # Logs pathfinding start/end
	set_country_flag = WA_AI_pathfind_detailed_logging  # Logs every pathfind step (verbose)
}

WA_AI_force_railway_calculation = {
	set_variable = { WA_AI_PC_railway_INTERVAL_counter = 0 }
}

WA_AI_clear_PC_queue = {
	log = "=== CLEARING WA_AI_PC_queue for [Root.GetName] ==="
	log = "  Had [?WA_AI_PC_queue^num] projects"
	clear_array = WA_AI_PC_queue
	set_variable = { WA_AI_PC_assigned_factories_total = 0 }
	set_variable = { WA_AI_PC_active_projects = 0 }
	set_variable = { WA_AI_PC_next_project_id = 1 }
	log = "  Queue cleared, counters reset"
}

WA_see_PC_queue = {
	log = "=== WA_AI_PC_queue for [Root.GetName] ==="
	log = "  Total queued projects: [?WA_AI_PC_queue^num]"
	log = "  Active projects count: [?WA_AI_PC_active_projects]"
	log = "  Assigned factories total: [?WA_AI_PC_assigned_factories_total]"
	log = "  Available civs for projects: [?num_of_civilian_factories_available_for_projects]"

	for_each_loop = { array = WA_AI_PC_queue value = _dbg_proj_id
		set_temp_variable = { _dbg_type = WA_AI_PC_building_type^_dbg_proj_id }
		set_temp_variable = { _dbg_prio = WA_AI_PC_priority^_dbg_proj_id }
		set_temp_variable = { _dbg_cost = WA_AI_PC_project_cost^_dbg_proj_id }
		set_temp_variable = { _dbg_prog = WA_AI_PC_progress^_dbg_proj_id }
		set_temp_variable = { _dbg_prov = WA_AI_PC_target_province^_dbg_proj_id }
		set_temp_variable = { _dbg_conn = WA_AI_PC_connect_province^_dbg_proj_id }
		set_temp_variable = { _dbg_state = WA_AI_PC_target_state^_dbg_proj_id }
		set_temp_variable = { _dbg_facs = WA_AI_PC_assigned_factories^_dbg_proj_id }
		log = "  Project [?_dbg_proj_id]: type=[?_dbg_type] prio=[?_dbg_prio] cost=[?_dbg_cost] progress=[?_dbg_prog] factories=[?_dbg_facs] prov=[?_dbg_prov]->[?_dbg_conn] state=[?_dbg_state]"
	}

	if = { limit = { check_variable = { WA_AI_PC_queue^num = 0 } }
		log = "  (no projects in queue)"
	}
	log = "=== END PC QUEUE ==="
}

############################################################################################################
#	TEST SYSTEM - Console Commands
#	d_ prefix makes these available as console commands
############################################################################################################

d_WA_TEST_railway = {
	WA_TEST_railway_suite = yes
	log = "Railway test suite launched for JAP - check game.log for results"
}

d_WA_TEST_results = {
	WA_TEST_print_all = yes
	log = "Test results dumped to game.log"
}