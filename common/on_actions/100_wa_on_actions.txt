on_actions = {
	on_startup = {
		effect = {
			every_country = {
				add_ideas = Coastal_fort_nerf
				add_dynamic_modifier = {
					modifier = military_industrial_capital
				}
			}
		}
		effect = {
			every_state = {
				limit = {
					OR = {
						is_core_of = GER
						is_core_of = JAP
					}
				}
				set_state_flag = allied_nuke_target
			}
		}
		effect = {
			every_country = {
				limit = {
					NOT = {
						original_tag = FRA
						original_tag = ENG
						original_tag = GER
						original_tag = ITA
						original_tag = SOV
						original_tag = POL
						original_tag = CZE
						original_tag = HUN
						original_tag = ROM
						original_tag = BUL
						original_tag = GRE
						original_tag = NOR
						original_tag = FIN
						original_tag = DEN
						original_tag = SPR
						original_tag = POR
						original_tag = BEL
						original_tag = HOL
						original_tag = LUX
						original_tag = AUS
						original_tag = YUG
						original_tag = SWI
						original_tag = EST
						original_tag = LAT
						original_tag = LIT
					}
				}
				reverse_add_opinion_modifier = { target = SWE modifier = european_market_preference }
			}
		}
		effect = {
			every_country = {
				## Steel ##
				set_variable = {this.open_steel_mill_target = 0 }
				set_variable = {this.total_steel_mill = 0 }
				set_variable = {this.total_steel_mill_core = 0 }
				set_variable = {this.current_steel_mill_core = 0 }
				every_controlled_state = {
					add_to_variable = {
						prev.open_steel_mill_target = building_level@steel_refinery
					}
					add_to_variable = {
						prev.open_steel_mill_target = building_level@hydro_steel_refinery
					}
					add_to_variable = {
						prev.total_steel_mill = building_level@steel_refinery_inactive
					}
					add_to_variable = {
						prev.total_steel_mill = building_level@hydro_steel_refinery_inactive
					}
				}
				every_controlled_state = {
					limit = {
						is_core_of = prev
					}
					add_to_variable = {
						prev.current_steel_mill_core = building_level@steel_refinery
					}
					add_to_variable = {
						prev.current_steel_mill_core = building_level@hydro_steel_refinery
					}
					add_to_variable = {
						prev.total_steel_mill_core = building_level@steel_refinery_inactive
					}
					add_to_variable = {
						prev.total_steel_mill_core = building_level@hydro_steel_refinery_inactive
					}
				}
				add_to_variable = {
					this.total_steel_mill = this.open_steel_mill_target
				}
				add_to_variable = {
					this.total_steel_mill_core = this.current_steel_mill_core
				}
				set_variable = {this.current_steel_mills = this.open_steel_mill_target }

				## Aluminum ##
				set_variable = {this.open_alu_mill_target = 0 }
				set_variable = {this.total_alu_mill = 0 }
				set_variable = {this.total_alu_mill_core = 0 }
				set_variable = {this.current_alu_mill_core = 0 }
				every_controlled_state = {
					add_to_variable = {
						prev.open_alu_mill_target = building_level@aluminium_refinery
					}
					add_to_variable = {
						prev.open_alu_mill_target = building_level@hydro_aluminium_refinery
					}
					add_to_variable = {
						prev.total_alu_mill = building_level@aluminium_refinery_inactive
					}
					add_to_variable = {
						prev.total_alu_mill = building_level@hydro_aluminium_refinery_inactive
					}
				}
				every_controlled_state = {
					limit = {
						is_core_of = prev
					}
					add_to_variable = {
						prev.current_alu_mill_core = building_level@aluminium_refinery
					}
					add_to_variable = {
						prev.current_alu_mill_core = building_level@hydro_aluminium_refinery
					}
					add_to_variable = {
						prev.total_alu_mill_core = building_level@aluminium_refinery_inactive
					}
					add_to_variable = {
						prev.total_alu_mill_core = building_level@hydro_aluminium_refinery_inactive
					}
				}
				add_to_variable = {
					this.total_alu_mill = this.open_alu_mill_target
				}
				add_to_variable = {
					this.total_alu_mill_core = this.current_alu_mill_core
				}
				set_variable = {this.current_alu_mills = this.open_alu_mill_target }

				## Synths ##
				set_variable = {this.open_synth_target = 0 }
				set_variable = {this.total_synth = 0 }
				set_variable = {this.total_synth_core = 0 }
				set_variable = {this.current_synth_core = 0 }
				every_controlled_state = {
					add_to_variable = {
						prev.open_synth_target = building_level@synthetic_refinery
					}
					add_to_variable = {
						prev.total_synth = building_level@synthetic_refinery_inactive
					}
				}
				every_controlled_state = {
					limit = {
						is_core_of = prev
					}
					add_to_variable = {
						prev.current_synth_core = building_level@synthetic_refinery
					}
					add_to_variable = {
						prev.total_synth_core = building_level@synthetic_refinery_inactive
					}
				}
				add_to_variable = {
					this.total_synth = this.open_synth_target
				}
				add_to_variable = {
					this.total_synth_core = this.current_synth_core
				}
				set_variable = {this.current_synth = this.open_synth_target }
			}
		}
		effect = {
			every_country = {
				limit = {
					exists = yes
					check_variable = { num_core_states > 0 }
				}
				add_to_array = {
					global.starting_tags = THIS
				}
				add_to_array = {
					global.starting_tags_exploit = THIS
				}
			}
			add_to_array = {
				global.starting_tags_exploit = UKR
			}
			add_to_array = {
				global.starting_tags_exploit = BLR
			}
		}
		effect = {
			random_country = {
				create_economic_fatigue_array = yes
			}
		}
		effect = {
			every_country = {
				if = {
					limit = {
						NOT = {
							has_variable = reserves
						}
					}
					set_variable = { reserves = 0 }
				}
				if = {
					limit = {
						NOT = {
							has_variable = reserves_equipment
						}
					}
					set_variable = { reserves_equipment = 0.1 }
				}
				country_event = { id = afo_event.1 }
				set_global_flag = world_ablaze
				if = {
					limit = {
						has_game_rule = {
							rule = allow_eastereggs
							option = EASTEREGGS_ALLOWED
						}
					}
					country_event = { id = afo_event.19 }
				}
			}
			if = {
				limit = {
					SOV = {
						is_ai = no
					}
				}
				every_country = {
					limit = {
						NOT = { is_in_faction_with = SOV }
					}
					reverse_add_opinion_modifier = {
						target = SOV
						modifier = isolated_economy
					}
				}
			}
			1043 = {
				add_dynamic_modifier = { modifier = autonomous_state }
			}
			1042 = {
				add_dynamic_modifier = { modifier = autonomous_state }
			}
			1041 = {
				add_dynamic_modifier = { modifier = shia_community_unrest }
			}
			every_country = {
				limit = {
					has_idea = league_of_nations
					NOT = { tag = ENG }
					NOT = { tag = FRA }
				}
				add_opinion_modifier = {
					target = FRA
					modifier = League_of_nations_opinion
				}
				add_opinion_modifier = {
					target = ENG
					modifier = League_of_nations_opinion
				}
			}
			#			every_country = {
			#				limit = {
			#					is_ai = yes
			#				}
			#				set_technology = {
			#					iron_bauxite_1 = 1
			#				}
			#				add_equipment_production = {
			#					equipment = {
			#						type = iron_bauxite_equipment_1
			#					}
			#					requested_factories = 1
			#					progress = 0.1
			#					efficiency = 10
			#				}
			#			}
			FRA = {
				add_opinion_modifier = {
					target = ENG
					modifier = League_of_nations_opinion
				}
			}
			ITA = {
				complete_national_focus = ITA_ethiopian_war_logistics
				every_army_leader = {
					limit = {
						NOT = {
							has_trait = incompetent_unit_leader
						}
					}
					add_unit_leader_trait = inadequate_army_trait
				}
			}
			JAP = {
				set_autonomy = {
					target = MAN
					autonomous_state = autonomy_wtt_imperial_associate
					freedom_level = 0.4
				}
				set_autonomy = {
					target = MEN
					autonomous_state = autonomy_wtt_imperial_associate
					freedom_level = 0.4
				}
			}
			SOV = {
				complete_national_focus = SOV_start_the_second_five_year_plan
				add_equipment_to_stockpile = {
					type = tank_sov_light_chassis_support_1
					amount = 1943
					producer = SOV
				}
				add_equipment_to_stockpile = {
					type = tank_sov_light_chassis_1
					amount = 750
					producer = SOV
				}
				give_resource_rights = {
					receiver = JAP
    				state = 655
				}
			}
			ENG = {
				add_opinion_modifier = {
					target = FRA
					modifier = League_of_nations_opinion
				}
			}
			every_state = {
				limit = {
					OR = {
						is_core_of = USA
					}
				}
				add_dynamic_modifier = { modifier = great_depression_state }
			}
			every_state = {
				limit = {
					OR = {
						is_core_of = MON
						is_core_of = CHI
						is_core_of = KOR
						is_core_of = PHI
						is_core_of = MLY
						is_core_of = IND
						is_core_of = NEP
						is_core_of = BHU
						is_core_of = TIB
						is_core_of = PAK
						is_core_of = RAJ
						is_core_of = PNG
						is_core_of = SRL
						is_core_of = SIA
						is_core_of = VIN
						is_core_of = CAM
						is_core_of = LAO
						is_core_of = PER
						is_core_of = IRQ
						is_core_of = SAU
						is_core_of = YEM
						is_core_of = OMA
						is_core_of = AFG
						is_core_of = MEX
						is_core_of = BRM
						is_core_of = PAL
						is_core_of = JOR
						#is_core_of = TAN
						is_on_continent = africa
						is_on_continent = south_america
						state = 721
						state = 634
					}
					# CHI
					NOT = { state = 613 }
					NOT = { state = 924 }
					NOT = { state = 598 }
					NOT = { state = 949 }
					NOT = { state = 608 }
					#
					NOT = { state = 446 }
					NOT = { state = 447 }
					NOT = { state = 923 }
					NOT = { state = 452 }
					NOT = { state = 451 }
					NOT = { state = 450 }
					NOT = { state = 448 }
					NOT = { state = 449 }
					NOT = { state = 458 }
					NOT = { state = 460 }
					NOT = { state = 459 }
					NOT = { state = 461 }
					NOT = { state = 327 }
					#
					NOT = { state = 745 }
				}
				add_dynamic_modifier = { modifier = agrarian_state }
			}
			every_state = {
				limit = {
					OR = {
						is_core_of = FIN
						is_core_of = SOV
					}
					# FIN
					NOT = { state = 111 }
					# SOV
					NOT = { state = 213 }
					NOT = { state = 1046 }
					NOT = { state = 1047 }
					NOT = { state = 215 }
					NOT = { state = 216 }
					NOT = { state = 195 }
					NOT = { state = 208 }
					NOT = { state = 244 }
					NOT = { state = 209 }
					NOT = { state = 263 }
					NOT = { state = 210 }
					NOT = { state = 246 }
					NOT = { state = 242 }
					NOT = { state = 219 }
					NOT = { state = 252 }
					NOT = { state = 243 }
					NOT = { state = 205 }
					NOT = { state = 223 }
					NOT = { state = 224 }
					NOT = { state = 222 }
					NOT = { state = 258 }
					NOT = { state = 220 }
					NOT = { state = 240 }
					NOT = { state = 260 }
					NOT = { state = 245 }
					NOT = { state = 218 }
					NOT = { state = 217 }
					NOT = { state = 234 }
					NOT = { state = 137 }
					NOT = { is_core_of = BLR }
					NOT = { is_core_of = UKR }
				}
				add_dynamic_modifier = { modifier = underdeveloped_state }
			}
			980 = {
				add_dynamic_modifier = { modifier = enclave }
			}
			783 = {
				add_dynamic_modifier = { modifier = enclave }
			}
			729 = {
				add_dynamic_modifier = { modifier = enclave }
			}
			1022 = {
				add_dynamic_modifier = { modifier = enclave }
			}
			888 = {
				add_dynamic_modifier = { modifier = enclave }
			}
			USA = {
				add_to_variable = { USA_pacific_control = 38 }
				add_to_variable = { JAP_pacific_control = 37 }
				add_to_variable = { ENG_pacific_control = 25 }
			}
			JAP = {
				add_to_variable = { USA_pacific_control = 38 }
				add_to_variable = { JAP_pacific_control = 37 }
				add_to_variable = { ENG_pacific_control = 25 }
			}
			ENG = {
				add_to_variable = { USA_pacific_control = 38 }
				add_to_variable = { JAP_pacific_control = 37 }
				add_to_variable = { ENG_pacific_control = 25 }
				add_to_variable = { ENG_med_control = 55 }
				add_to_variable = { ITA_med_control = 45 }
			}
			ITA = {
				add_to_variable = { ENG_med_control = 55 }
				add_to_variable = { ITA_med_control = 45 }
			}
			set_variable = { global.GER_ee_control = 4 }
			set_variable = { global.SOV_ee_control = 75 }
			set_variable = { global.ROM_ee_control = 4 }
			set_variable = { global.POL_ee_control = 5 }
			set_variable = { global.EST_ee_control = 4 }
			set_variable = { global.LAT_ee_control = 4 }
			set_variable = { global.LIT_ee_control = 4 }
			GER = {
				set_country_flag = holds_konigsberg
			}
			SOV = {
				set_country_flag = holds_odessa
				set_country_flag = holds_murmansk
				set_country_flag = holds_dnepropetrovsk
				set_country_flag = holds_minsk
				set_country_flag = holds_kiev
				set_country_flag = holds_smolensk
				set_country_flag = holds_gomel
				set_country_flag = holds_bryansk
				set_country_flag = holds_kharkov
				set_country_flag = holds_sevastapol
				set_country_flag = holds_leningrad
				set_country_flag = holds_moscow
				set_country_flag = holds_stalingrad
				set_country_flag = holds_rostov
				set_country_flag = holds_baku
				set_country_flag = holds_gorky
				set_country_flag = holds_kazan
			}
			ROM = {
				set_country_flag = holds_besserabia
			}
			POL = {
				set_country_flag = holds_eastern_poland
			}
			EST = {
				set_country_flag = holds_tallinn
			}
			LAT = {
				set_country_flag = holds_riga
			}
			LIT = {
				set_country_flag = holds_kaunas
			}
		}
		effect = {
			FRA = {
				FRA_disjointed_government_level = yes
			}
		}
		effect = {
			if = {
				limit = {
					FRA = { is_ai = no }
				}
				FRA = {
					if = {
						limit = { has_dlc = "By Blood Alone" }
						load_oob = "FRA_1936_air_bba_player"
					}
					else = {
						load_oob = "FRA_1936_air_legacy_player"
					}
					add_manpower = -40000
				}
			}
		}
		effect = {
			if = {
				limit = {
					FRA = { is_ai = yes }
				}
				FRA = {
					add_manpower = -40000
				}
			}
		}
		################################Needed to fix AI carrier plane composition
		effect = {
			if = {
				limit = {
					ENG = { is_ai = no }
				}
				ENG = {
					if = {
						limit = { has_dlc = "Man the Guns" }
						#### ARK Royal
						add_equipment_production = {
							equipment = {
								type = eng_carrier_hull_3
								creator = "ENG"

							}
							name = "HMS Ark Royal"
							requested_factories = 3
							progress = 0.25
							amount = 1
							industrial_manufacturer = mio:ENG_harland_wolff_organization
						}
					}
					if = {
						limit = { has_dlc = "By Blood Alone" }
						load_oob = "ENG_1936_air_bba_player"
						load_oob = "ENG_1936_air_bba"
					}
					else = {
						load_oob = "ENG_1936_air_legacy_player"
						load_oob = "ENG_1936_air_legacy"
					}
					load_oob = "ENG_1936_Cavalry"
				}
			}
		}
		effect = {
			if = {
				limit = {
					USA = { is_ai = no }
				}
				USA = {
					if = {
						limit = { has_dlc = "Man the Guns" }
						# CA: Wichita (Wichita class
						add_equipment_production = {
							equipment = {
								type = usa_heavy_cruiser_hull_4
								creator = "USA"
							}
							name = "USS Wichita"
							requested_factories = 3
							progress = 0.84
							amount = 1
							industrial_manufacturer = mio:USA_brooklyn_naval_yard_organization
						}
						##2 Yorktowns (Yorktown, Enterprise)
						add_equipment_production = {
							equipment = {
								type = usa_carrier_hull_4
								creator = "USA"
							}
							name = "USS Yorktown"
							requested_factories = 3
							progress = 0.96
							amount = 1
							industrial_manufacturer = mio:USA_newport_news_shipbuilding_organization
						}
						add_equipment_production = {
							equipment = {
								type = usa_carrier_hull_4
								creator = "USA"
							}
							name = "USS Enterprise"
							requested_factories = 3
							progress = 0.93
							amount = 1
							industrial_manufacturer = mio:USA_newport_news_shipbuilding_organization
						}
					}
					if = {
						limit = { has_dlc = "By Blood Alone" }
						load_oob = "USA_1936_air_bba"
					}
					else = {
						load_oob = "USA_1936_air_legacy"
					}
				}
			}
		}
		effect = {
			if = {
				limit = {
					USA = { is_ai = yes }
				}
				USA = {
					if = {
						limit = { has_dlc = "By Blood Alone" }
						load_oob = "USA_1936_air_bba_ai"
					}
					else = {
						load_oob = "USA_1936_air_legacy"
					}
				}
			}
		}
		effect = {
			if = {
				limit = {
					JAP = { is_ai = no }
				}
				JAP = {
					if = {
						limit = { has_dlc = "Man the Guns" }
						# CV (x1): "Soryu"
						add_equipment_production = {
							equipment = {
								type = jap_carrier_hull_3
								creator = "JAP"
							}
							requested_factories = 5
							progress = 0.58

							amount = 1
							industrial_manufacturer = mio:JAP_yokosuka_naval_arsenal_organization
						}
						add_equipment_production = {
							equipment = {
								type = jap_light_carrier_hull_3
								creator = "JAP"
							}
							requested_factories = 4
							progress = 0.54
							name = "Chitose"
							amount = 1
							industrial_manufacturer = mio:JAP_yokosuka_naval_arsenal_organization
						}
					}
					if = {
						limit = { has_dlc = "By Blood Alone" }
						load_oob = "JAP_1936_air_bba"
					}
					else = {
						load_oob = "JAP_1936_air_legacy"
					}
				}
			}
		}
		effect = {
			if = {
				limit = {
					JAP = { is_ai = yes }
				}
				JAP = {
					if = {
						limit = { has_dlc = "By Blood Alone" }
						load_oob = "JAP_1936_air_bba_ai"
					}
					else = {
						load_oob = "JAP_1936_air_legacy"
					}
				}
			}
		}
		################################
		effect = {
			if = {
				limit = {
					GER = { is_ai = no }
				}
				GER = {
					if = {
						limit = { has_dlc = "By Blood Alone" }
						load_oob = "GER_1936_air_bba_player"
					}
					else = {
						load_oob = "GER_1936_air_legacy_player"
					}
					load_oob = "GER_1936_Cavalry"
				}
			}
		}
		effect = {
			if = {
				limit = {
					ITA = { is_ai = no }
				}
				ITA = {
					load_oob = "ITA_1936_Cavalry"
				}
			}
		}
		effect = {
			if = {
				limit = {
					JAP = { is_ai = no }
				}
				JAP = {
					load_oob = "JAP_1936_Cavalry"
				}
			}
		}
		effect = {
			if = {
				limit = {
					NOT = { has_dlc = "No Step Back" }
					SOV = { is_ai = no }
				}
				SOV = {
					set_technology = { sov_armoured_car_1 = 1 popup = no }
					set_technology = { sov_scout_car_1 = 1 popup = no }
					load_oob = "SOV_1936_cavalry"
				}
			}
			if = {
				limit = {
					has_dlc = "No Step Back"
					SOV = { is_ai = no }
				}
				SOV = {
					set_technology = { sov_combat_armoured_car_1 = 1 popup = no }
					set_technology = { sov_scout_armoured_car_1 = 1 popup = no }
					load_oob = "SOV_1936_cavalry_nsb"
				}
			}
		}
		effect = {
			if = {
				limit = {
					USA = { is_ai = no }
				}
				USA = {
					load_oob = "USA_1936_Cavalry"
				}
			}
		}
		effect = {
			if = {
				limit = {
					is_historical_focus_on = yes
					POR = {
						is_ai = yes
					}
				}
				POR = {
					set_rule = { can_not_declare_war = yes }
				}
			}
		}
		effect = {
			if = {
				limit = {
					is_historical_focus_on = yes
					SOV = {
						is_ai = yes
					}
				}
				SOV = {
					set_rule = { can_send_volunteers = no }
				}
			}
		}
		effect = {
			if = {
				limit = {
					COS = {
						is_ai = yes
					}
				}
				COS = {
					set_rule = { can_join_factions = no }
				}
			}
		}
		effect = {
			if = {
				limit = {
					PRU = {
						is_ai = yes
					}
				}
				PRU = {
					set_rule = { can_join_factions = no }
				}
			}
		}
		effect = {
			if = {
				limit = {
					USA = { is_ai = yes }
				}
				630 = {
					add_dynamic_modifier = { modifier = island_province_ai }
				}
				631 = {
					add_dynamic_modifier = { modifier = island_province_ai }
				}
				632 = {
					add_dynamic_modifier = { modifier = island_province_ai }
				}
				633 = {
					add_dynamic_modifier = { modifier = island_province_ai }
				}
				638 = {
					add_dynamic_modifier = { modifier = island_province_ai }
				}
				639 = {
					add_dynamic_modifier = { modifier = island_province_ai }
				}
				642 = {
					add_dynamic_modifier = { modifier = island_province_ai }
				}
				725 = {
					add_dynamic_modifier = { modifier = island_province_ai }
				}
			}
		}
		effect = {
			if = {
				limit = {
					ENG = { is_ai = yes }
				}
				118 = {
					add_dynamic_modifier = { modifier = island_province_ai }
				}
				116 = {
					add_dynamic_modifier = { modifier = island_province_ai }
				}
			}
		}
		effect = {
			if = {
				limit = {
					JAP = { is_ai = yes }
				}
				648 = {
					add_dynamic_modifier = { modifier = island_province_ai }
				}
				645 = {
					add_dynamic_modifier = { modifier = island_province_ai }
				}
				613 = {
					add_dynamic_modifier = { modifier = island_province_ai }
				}
				924 = {
					add_dynamic_modifier = { modifier = island_province_ai }
				}
			}
		}
		effect = {
			28 = {
				add_building_construction = {
					type = bunker
					level = 9
					instant_build = yes
					province = {
						all_provinces = yes
						limit_to_border_country = GER
					}
				}
				add_building_construction = {
					type = bunker
					level = 9
					instant_build = yes
					province = {
						id = 9559
					}
				}
			}
		}
	}

	on_war = {
		effect = {
			if = {
				limit = {
					is_major = yes
					all_enemy_country = {
						ic_ratio = {
							tag = ROOT
							ratio < 0.75
						}
						OR = {
							original_tag = CHI
							original_tag = PRC
							is_major = no
						}
					}
					NOT = { has_idea = inferior_enemy }
				}
				add_ideas = inferior_enemy
			}
		}
		effect = {
			if = {
				limit = {
					tag = SOV
					SOV = {
						has_global_flag = sov_yes_pact
						any_enemy_country = {
							NOT = { has_war_with = GER }
						}
						NOT = { has_country_flag = SOV_war_since_start }
					}
				}
				set_country_flag = SOV_war_since_start
			}
			if = {
				limit = {
					tag = SOV
					SOV = {
						NOT = { has_global_flag = sov_yes_pact }
						NOT = { has_country_flag = SOV_war_since_start }
					}
				}
				set_country_flag = SOV_war_since_start
			}
		}
		effect = {
			if = {
				limit = {
					tag = FIN
				}
				set_country_flag = FIN_war_since_start
			}
		}
		effect = {
			if = {
				limit = {
					tag = FRA
					not = {
						has_country_flag = FRA_prevent_war_since_start_flag
					}
				}
				set_country_flag = FRA_war_since_start
			}
		}
		effect = {
			if = {
				limit = {
					tag = JAP
					has_war_with = CHI
				}
				set_country_flag = { flag = JAP_CHI_war_since_start days = 360 }
			}
		}
		effect = {
			if = {
				limit = {
					JAP = { has_war_with = USA }
				}
				set_global_flag = ww2_pacific_flag
			}
		}
		effect = {
			if = {
				limit = {
					GER = { has_war_with = ENG }
				}
				set_global_flag = ww2_western_europe_flag
			}
		}
		effect = {
			if = {
				limit = {
					GER = { has_war_with = SOV }
				}
				set_global_flag = ww2_eastern_europe_flag
			}
		}
		effect = {
			if = {
				limit = {
					tag = USA
					has_completed_focus = USA_selective_service_act
				}
				if = {
					limit = {
						OR = {
							has_idea = disarmed_nation
							has_idea = volunteer_only
						}
					}
					add_ideas = USA_selective_service
				}
			}
		}
		effect = {
			if = {
				limit = {
					GER = { has_war_with = SWI }
					GER = { has_completed_focus = GER_swiss_franc_agreement }
				}
				activate_decision = POR_rip_up_the_swiss_franc_agreement
				GER = {
					remove_resource_rights = 180
					remove_ideas = swiss_franc_agreement_GER
				}
			}
		}
		effect = {
			if = {
				limit = {
					GER = { has_war_with = TUR }
					GER = { has_completed_focus = GER_clodius_agreement }
				}
				GER = {
					remove_resource_rights = 342
				}
			}
		}
		effect = {
			if = {
				limit = {
					IRQ = { has_war_with = ENG }
				}
				ENG = {
					remove_resource_rights = 1042
					remove_resource_rights = 1041
				}
				if = {
					limit = {
						IRQ = { has_completed_focus = IRQ_new_standard_oil_contracts }
					}
					USA = {
						remove_resource_rights = 676
						remove_resource_rights = 291
					}
				}
			}
		}
		effect = {
			if = {
				limit = {
					IRQ = { has_war_with = USA }
					IRQ = { has_completed_focus = IRQ_new_standard_oil_contracts }
				}
				USA = {
					remove_resource_rights = 676
					remove_resource_rights = 291
				}
				ENG = {
					remove_resource_rights = 1042
					remove_resource_rights = 1041
				}
			}
		}
		effect = {
			if = {
				limit = {
					has_idea = league_of_nations
					OR = {
						AND = {
							has_war_With = ENG
							ENG = { has_idea = league_of_nations }
						}
						AND = {
							has_war_With = FRA
							FRA = { has_idea = league_of_nations }
						}
						AND = {
							has_war_With = FRA
							tag = ENG
						}
						AND = {
							has_war_With = ENG
							tag = FRA
						}
					}
				}
				remove_ideas = league_of_nations
			}
		}
		effect = {
			if = {
				limit = {
					GER = { has_war_with = POL }
					NOT = { SOV = { has_war_With = GER } }
					NOT = { SOV = { has_war_With = POL } }
					NOT = { has_global_flag = invade_poland_question }
					SOV = { has_global_flag = sov_yes_pact }
					SOV = { NOT = { has_global_flag = mr_honored } }
					SOV = { NOT = { has_global_flag = mr_not_honored } }
					OR = {
						POL = { controls_state = 96 }
						POL = { controls_state = 95 }
						POL = { controls_state = 97 }
						POL = { controls_state = 94 }
						POL = { controls_state = 93 }
						POL = { controls_state = 91 }
						POL = { controls_state = 89 }
					}
				}
				set_global_flag = invade_poland_question
				SOV = { country_event = { days = 14 id = sov_armor.819 } }
			}
		}
		effect = {
			if = {
				limit = {
					THIS = {
						tag = GER
					}
				}
				if = {
					limit = {
						has_idea = GER_prepare_for_the_next_blockade
					}
					remove_ideas = GER_prepare_for_the_next_blockade
					clr_country_flag = ger_blockade_prepared
				}
			}
		}
		effect = {
			if = {
				limit = {
					THIS = {
						tag = GER
						has_war_with = ENG
						has_country_flag = ger_blockade_prepared
					}
				}
				add_ideas = GER_prepare_for_the_next_blockade_2
			}
		}
	}

	on_declare_war = {
		effect = {
			if = {
				limit = {
					FROM = {
						tag = USA
						has_country_flag = end_mobilization
					}
				}
				FROM = {
					clr_country_flag = end_mobilization
				}
			}
			else_if = {
				limit = {
					tag = USA
					has_country_flag = end_mobilization
				}
				clr_country_flag = end_mobilization
			}
		}
		effect = {
			if = {
				limit = {
					tag = HUN
					OR = {
						has_global_flag = HUN_limited_war_states_@FROM
						has_global_flag = HUN_limited_war_puppet_@FROM
					}
					FROM = {
						is_in_faction = no
					}
				}
				FROM = {
					add_ai_strategy = {
						type = diplo_action_acceptance
						id = ENG
						value = -100
						target = join_allies
					}
					add_ai_strategy = {
						type = diplo_action_acceptance
						id = GER
						value = -100
						target = join_allies
					}
					add_ai_strategy = {
						type = diplo_action_acceptance
						id = ITA
						value = -100
						target = join_allies
					}
					add_ai_strategy = {
						type = diplo_action_acceptance
						id = FRA
						value = -100
						target = join_allies
					}
				}
			}
		}
		effect = {
			FROM = {
				if = {
					limit = {
						tag = HUN
						has_country_flag = HUN_outlast_the_invasion
					}
					clr_country_flag = HUN_outlast_the_invasion
					activate_mission = HUN_outlast_the_invasion
				}
			}
		}
		effect = {
			if = {
				limit = {
					ROOT = {
						tag = ITA
						is_in_faction_with = GER
					}
					FROM = {
						tag = GRE
					}
				}
				FROM = {
					activate_decision = GRE_italian_war_mission_GRE
				}
				ROOT = {
					activate_decision = GRE_italian_war_mission_ita
				}
			}
		}
		effect = {
			if = {
				limit = {
					ROOT = {
						tag = ROM
						is_in_faction_with = GER
					}
					FROM = {
						tag = SOV
					}
				}
				ROOT = {
					activate_decision = ROM_soviet_war_mission
				}
			}
		}
		effect = {
			if = {
				limit = {
					ROOT = {
						tag = ITA
					}
					FROM = {
						tag = GRE
					}
					any_country = {
						original_tag = ALB
						is_subject_of = ITA
					}
				}
				ALB = {
					add_to_war = {
						targeted_alliance = ITA
						enemy = GRE
						hostility_reason = asked_to_join
					}
				}
			}
		}
	}

	on_peace = {
		effect = {
			if = {
				limit = {
					has_global_flag = WA_winter_war_flag
					THIS = { tag = FIN }
				}
				clr_global_flag = WA_winter_war_flag
				FIN = {
					remove_dynamic_modifier = { modifier = FIN_winter_war_modifiers }
				}
				SOV = {
					remove_dynamic_modifier = { modifier = SOV_winter_war_modifiers }
				}
			}
		}
		effect = {
			if = {
				limit = {
					OR = {
						ETH = { exists = no }
						NOT = { ETH = { has_war_with = ITA } }
					}
				}
				clr_global_flag = second_italo_ethiopian_war_flag
			}
		}
		effect = {
			if = {
				limit = {
					has_country_flag = FIN_war_since_start
				}
				set_country_flag = FIN_lessons_of_war_check_flag
				if = {
					limit = {
						has_template = "French Volunteers"
					}
					delete_unit_template_and_units = { division_template = "French Volunteers" disband = yes}
					FRA = {
						division_template = {
							name = "French Volunteers"
							is_locked = yes
							regiments = {
								mountaineers = { x = 0 y = 0}
								mountaineers = { x = 0 y = 1}
								mountaineers = { x = 0 y = 2}

								mountaineers = { x = 1 y = 0}
								mountaineers = { x = 1 y = 1}
								mountaineers = { x = 1 y = 2}

								mountaineers = { x = 2 y = 0}
								mountaineers = { x = 2 y = 1}
								mountaineers = { x = 2 y = 2}

								artillery_brigade = { x = 3 y = 0}
								artillery_brigade = { x = 3 y = 1}
								artillery_brigade = { x = 3 y = 2}
							}

							support = {
								horse_logistics_company = {x = 0 y = 0}
								engineer = {x = 0 y = 1}
								recon = {x = 1 y = 0}
								horse_field_hospital = {x = 1 y = 1}
								signal_company = {x = 0 y = 2}
							}
						}
						random_owned_state = {
							create_unit = {
								division = "name = \"Volunteers from Finland\" division_template = \"French Volunteers\" start_experience_factor = 1 start_equipment_factor = 1"
								owner = FRA
							}
						}
					}
				}
			}
		}
		effect = {
			if = {
				limit = {
					has_country_flag = SOV_war_since_start
				}
				set_country_flag = SOV_lessons_of_war_check_flag
			}
		}
	}

	on_capitulation = {
		effect = {
			if = {
				limit = {
					original_tag = YUG
					NOT = { has_global_flag = YUG_partisans }
				}
				set_global_flag = YUG_partisans
				every_state = {
					limit = {
						is_core_of = YUG
						NOT = { is_core_of = CONTROLLER }
						NOT = { has_state_flag = YUG_partisan_activity_destroyed }
						NOT = { has_state_flag = YUG_dispersed_partisan_activity }
						NOT = {
							has_dynamic_modifier = {
								modifier = YUG_organized_partisan_activity
							}
						}
					}
					add_dynamic_modifier = { modifier = YUG_organized_partisan_activity }
				}
			}
		}
		effect = {
			if = {
				limit = {
					original_tag = GER
					has_government = fascism
					has_global_flag = GER_civil_war
				}
				GNS = {
					every_character = {
						set_nationality = GER
						set_character_flag = imprisoned_flag
					}
				}
			}
		}
		effect = {
			if = {
				limit = {
					original_tag = ROM
					has_government = neutrality
					has_global_flag = ROM_civil_war
				}
				RMC = {
					kill_country_leader = yes
					every_character = {
						set_nationality = ROM
					}
				}
			}
		}
		effect = {
			if = {
				limit = {
					original_tag = RUK
				}
				if = {
					limit = {
						GER = {
							has_idea = GER_famine_payments_ukraine
						}
					}
					GER = {
						swap_ideas = {
							remove_idea = GER_famine_payments_ukraine
							add_idea = GER_famine_payments
						}
					}
				}
			}
		}
		effect = {
			if = {
				limit = {
					tag = ENG
				}
				ENG = {
					every_state = {
						limit = {
							has_state_flag = ENG_resource_rights_flag
							OR = {
								is_controlled_by = ROOT
								CONTROLLER = { is_subject_of = ROOT }
							}
						}
						PREV = { remove_resource_rights = PREV }
						clr_state_flag = ENG_resource_rights_flag
					}
				}
			}
			if = {
				limit = {
					tag = FRA
				}
				FRA = {
					every_state = {
						limit = {
							has_state_flag = FRA_resource_rights_flag
							OR = {
								is_controlled_by = ROOT
								CONTROLLER = { is_subject_of = ROOT }
							}
						}
						PREV = { remove_resource_rights = PREV }
						clr_state_flag = FRA_resource_rights_flag
					}
				}
			}
			if = {
				limit = {
					tag = CAN
				}
				CAN = {
					every_state = {
						limit = {
							has_state_flag = CAN_resource_rights_flag
							OR = {
								is_controlled_by = ROOT
								CONTROLLER = { is_subject_of = ROOT }
							}
						}
						PREV = { remove_resource_rights = PREV }
						clr_state_flag = CAN_resource_rights_flag
					}
				}
			}
			if = {
				limit = {
					tag = BEL
				}
				BEL = {
					every_state = {
						limit = {
							has_state_flag = BEL_resource_rights_flag
							OR = {
								is_controlled_by = ROOT
								CONTROLLER = { is_subject_of = ROOT }
							}
						}
						PREV = { remove_resource_rights = PREV }
						clr_state_flag = BEL_resource_rights_flag
					}
				}
			}
			if = {
				limit = {
					tag = HOL
				}
				HOL = {
					every_state = {
						limit = {
							has_state_flag = HOL_resource_rights_flag
							OR = {
								is_controlled_by = ROOT
								CONTROLLER = { is_subject_of = ROOT }
							}
						}
						PREV = { remove_resource_rights = PREV }
						clr_state_flag = HOL_resource_rights_flag
					}
				}
			}
			if = {
				limit = {
					tag = POR
				}
				POR = {
					every_state = {
						limit = {
							has_state_flag = POR_resource_rights_flag
							OR = {
								is_controlled_by = ROOT
								CONTROLLER = { is_subject_of = ROOT }
							}
						}
						PREV = { remove_resource_rights = PREV }
						clr_state_flag = POR_resource_rights_flag
					}
				}
			}
		}
		effect = {
			if = {
				limit = {
					has_global_flag = HUN_limited_war_puppet_@ROOT
					ROOT = {
						is_in_faction = no
					}
				}
				clr_global_flag = HUN_limited_war_puppet_@ROOT
				FROM = {
					white_peace = ROOT
					set_autonomy = {
						target = ROOT
						autonomy_state = autonomy_puppet
					}
				}
			}
		}
		effect = {
			if = {
				limit = {
					ROOT = {
						tag = CZE
						is_in_faction = no
					}
				}
				clr_global_flag = HUN_limited_war_states_@ROOT
				FROM = {
					white_peace = ROOT
					annex_country = {
						target = ROOT
					}
				}
			}
		}
		effect = {
			if = {
				limit = {
					ROOT = {
						original_tag = GER
					}
					has_global_flag = yalta_agreed_flag
				}
				every_country = {
					limit = {
						OR = {
							is_in_faction_with = ROOT
							original_tag = GER
						}
					}
					every_state = {
						limit = {
							is_owned_by = prev
						}
						set_state_flag = yalta_target
					}
					set_country_flag = yalta_target_country
				}
				if = {
					limit = {
						GER = {
							has_war_with = POL
						}
					}
					every_state = {
						limit = {
							is_core_of = POL
						}
						set_state_flag = yalta_target
					}
				}
				if = {
					limit = {
						GER = {
							has_war_with = YUG
						}
					}
					every_state = {
						limit = {
							is_core_of = YUG
						}
						set_state_flag = yalta_target
					}
				}
				if = {
					limit = {
						GER = {
							has_war_with = GRE
						}
					}
					every_state = {
						limit = {
							is_core_of = GRE
						}
						set_state_flag = yalta_target
					}
				}
				if = {
					limit = {
						GER = {
							has_war_with = NOR
						}
					}
					every_state = {
						limit = {
							is_core_of = NOR
						}
						set_state_flag = yalta_target
					}
				}
			}
		}
		effect = {
			if = {
				limit = {
					ROOT = {
						is_subject_of = GER
						has_autonomy_state = autonomy_reichskommissariat
					}
				}
				GER = {
					add_to_variable = { GER_rk_consumer_goods_expected_value = -0.005 }
					if = {
						limit = {
							check_variable = { GER_rk_consumer_goods_expected_value = 0 compare = less_than_or_equals }
						}
						remove_dynamic_modifier = {
							modifier = GER_rk_obligations
						}
					}
				}
			}
			else_if = {
				limit = {
					ROOT = {
						is_subject_of = GER
						has_autonomy_state = autonomy_reichsprotectorate
					}
				}
				GER = {
					add_to_variable = { GER_rk_consumer_goods_expected_value = -0.01 }
					if = {
						limit = {
							check_variable = { GER_rk_consumer_goods_expected_value = 0 compare = less_than_or_equals }
						}
						remove_dynamic_modifier = {
							modifier = GER_rk_obligations
						}
					}
				}
			}
		}
	}
	on_capitulation_immediate = {
		effect = {
			if = {
				limit = {
					ROOT = {
						OR = {
							TAG = FRM
							TAG = FRN
							TAG = FRT
							TAG = FRJ
							TAG = FRV
							TAG = FRI
							TAG = FRP
							TAG = FRS
							TAG = FRC
						}
						is_in_faction = no
						has_war_with = FRA
					}
					FROM = {
						OR = {
							tag = FRA
							is_subject_of = FRA
							is_in_faction_with = FRA
						}
					}
				}
				FRA = {
					annex_country = {
						target = ROOT
					}
					country_event = { id =  fra_armor.2020 }
				}
			}
			else_if = {
				limit = {
					ROOT = {
						OR = {
							TAG = FRM
							TAG = FRN
							TAG = FRT
							TAG = FRJ
							TAG = FRV
							TAG = FRI
							TAG = FRP
							TAG = FRS
							TAG = FRC
						}
					}
					is_in_faction = no
				}
				FROM = {
					annex_country = {
						target = ROOT
					}
				}
			}
		}
	}

	on_peaceconference_started = {
		effect = {
			if = {
				limit = {
					GER = { controls_state = 85 }
					NOT = { 85 = { is_core_of = GER } }
				}
				85 = { add_core_of = GER }
			}
		}
		effect = {
			if = {
				limit = {
					GER = { controls_state = 798 }
					NOT = { 798 = { is_core_of = GER } }
				}
				798 = { add_core_of = GER }
			}
		}
	}
	on_peaceconference_ended = { ### yalta trigger
		effect = {
			if = {
				limit = {
					FROM = {
						tag = GER
					}
				}
				if = {
					limit = {
						NOT = {
							ENG = {
								has_war_with = SOV
							}
						}
						NOT = {
							USA = {
								has_war_with = SOV
							}
						}
						has_global_flag = yalta_agreed_flag
						country_exists = SOV
						country_exists = ENG
						country_exists = USA
					}
					SOV = {
						country_event = {
							id = yalta_event.1
							hours = 6
						}
					}
				}
				else_if = { # effect to set global flag if yalta is rejected
					limit = {
						NOT = {
							ENG = {
								has_war_with = SOV
							}
						}
						NOT = {
							USA = {
								has_war_with = SOV
							}
						}
						country_exists = SOV
						country_exists = ENG
						country_exists = USA
					}
					set_global_flag = ww2_has_ended
				}
			}
		}
	}

	on_annex = {
		effect = {
			if = {
				limit = {
					original_tag = YUG
					NOT = { has_global_flag = YUG_partisans }
				}
				set_global_flag = YUG_partisans
				every_state = {
					limit = {
						is_core_of = YUG
						NOT = { is_core_of = CONTROLLER }
						NOT = { has_state_flag = YUG_partisan_activity_destroyed }
						NOT = { has_state_flag = YUG_dispersed_partisan_activity }
						NOT = {
							has_dynamic_modifier = {
								modifier = YUG_organized_partisan_activity
							}
						}
					}
					add_dynamic_modifier = { modifier = YUG_organized_partisan_activity }
				}
			}
		}
		effect = {
			FROM = {
				if = {
					limit = {
						original_tag = GER
					}
					set_variable = { global.GER_ee_control = 0 }
				}
				else_if = {
					limit = {
						original_tag = SOV
					}
					set_variable = { global.SOV_ee_control = 0 }
				}
				else_if = {
					limit = {
						original_tag = ROM
					}
					set_variable = { global.ROM_ee_control = 0 }
				}
				else_if = {
					limit = {
						original_tag = POL
					}
					set_variable = { global.POL_ee_control = 0 }
				}
				else_if = {
					limit = {
						original_tag = EST
					}
					set_variable = { global.EST_ee_control = 0 }
				}
				else_if = {
					limit = {
						original_tag = LAT
					}
					set_variable = { global.LAT_ee_control = 0 }
				}
				else_if = {
					limit = {
						original_tag = LIT
					}
					set_variable = { global.LIT_ee_control = 0 }
				}
			}
		}
		effect = {
			FROM = {
				if = {
					limit = {
						has_country_flag = trade_fix_ai_strat
					}
					clr_country_flag = trade_fix_ai_strat
					add_offsite_building = { type = dockyard level = -1 }
				}
			}
		}
		effect = {
			ROOT = {
				if = {
					limit = {
						is_ai = no
					}
					every_unit_leader = {
						limit = { has_trait = ai_reassignment }
						remove_trait = { trait = ai_reassignment }
					}
					every_navy_leader = {
						limit = { has_trait = ai_admiral }
						remove_trait = { trait = ai_admiral }
					}
				}
			}
		}
	}

	on_civil_war_end = {
		effect = {
			# Give back SOV focus tree to STALIN if they win the civil war.
			if = {
				limit = {
					original_tag = SOV
					has_government = neutrality
					has_focus_tree = generic_focus
				}
				set_politics = { ruling_party = communism elections_allowed = no }
				add_popularity = { ideology = communism popularity = 1.0 }
				load_focus_tree = { tree = soviet_focus keep_completed = no }
				unlock_national_focus = SOV_great_purge
				add_ideas = home_of_revolution
			}
			#End of Belgian Fascist Civil War - Democrats won
			if = {
				limit = {
					original_tag = BEL
					has_government = democratic
					FROM = {
						has_government = fascism
						has_completed_focus = BEL_back_the_rexiste_party
					}
				}
				load_focus_tree = { tree = belgium_focus keep_completed = no }
				unlock_national_focus = BEL_abandon_the_alliance_with_france
			}
			#End of Finnish Communist Civil War - Democrats won
			if = {
				limit = {
					original_tag = FIN
					has_government = democratic
					FROM = {
						has_government = communism
						has_completed_focus = FIN_citizens_of_two_nations
					}
				}
				load_focus_tree = { tree = finland_focus keep_completed = no }
				unlock_national_focus = FIN_citizens_of_one_nation
			}
			#End of SCW fire refugee event
			if = {
				limit = {
					original_tag = SPR
					has_global_flag = scw_over
				}
				FRA = { country_event = fra_armor.818}
			}
		}
		effect = {
			if = {
				limit = {
					ROOT = {
						has_completed_focus = GER_mission_to_hungary
						has_country_flag = GER_civil_war_august_von_mackensen_leader
					}
					any_state = {
						is_core_of = AUS
						is_owned_by = GER
					}
				}
				GER = { country_event = ger_armor.227 }
			}
		}
	}

	on_government_change = {
		effect = {
			if = {
				limit = {
					has_government = fascism
					NOT = { has_idea = primative_economy }
					NOT = { has_idea = agrarian_society_1 }
					NOT = { has_idea = agrarian_society_2 }
					NOT = { has_idea = agrarian_society_3 }
					NOT = { has_idea = agrarian_society_4 }
					NOT = { has_idea = agrarian_society_5 }
				}
				add_ideas = national_syndicalism
			}
			else_if = {
				limit = {
					has_government = communism
					NOT = { has_idea = primative_economy }
					NOT = { has_idea = agrarian_society_1 }
					NOT = { has_idea = agrarian_society_2 }
					NOT = { has_idea = agrarian_society_3 }
					NOT = { has_idea = agrarian_society_4 }
					NOT = { has_idea = agrarian_society_5 }
					NOT = { has_idea = planned_economy }
				}
				add_ideas = market_socialism
			}
			else_if = {
				limit = {
					has_government = democratic
					NOT = { has_idea = primative_economy }
					NOT = { has_idea = agrarian_society_1 }
					NOT = { has_idea = agrarian_society_2 }
					NOT = { has_idea = agrarian_society_3 }
					NOT = { has_idea = agrarian_society_4 }
					NOT = { has_idea = agrarian_society_5 }
				}
				add_ideas = state_sponsored_economy
			}
			else_if = {
				limit = {
					has_government = neutrality
					NOT = { has_idea = primative_economy }
					NOT = { has_idea = agrarian_society_1 }
					NOT = { has_idea = agrarian_society_2 }
					NOT = { has_idea = agrarian_society_3 }
					NOT = { has_idea = agrarian_society_4 }
					NOT = { has_idea = agrarian_society_5 }
				}
				add_ideas = state_capitalism
			}
			else_if = {
				limit = {
					original_tag = SOV
					has_government = communism
				}
				add_ideas = planned_economy
			}
			else_if = {
				limit = {
					NOT = { has_idea = primative_economy }
				}
				add_ideas = agrarian_economy
			}
			else = {
				add_ideas = primative_economy
			}
		}
	}

	on_civil_war_end_before_annexation = {
		effect = {
			if = {
				limit = {
					FROM = {
						original_tag = FIN
					}
					has_completed_focus = FIN_march_towards_the_capital
				}
				set_global_flag = fcw_over
			}
		}
		effect = {
			if = { # Fascist victory ICW
				limit = {
					FROM = {
						original_tag = ITA
					}
					NOT = { has_completed_focus = ITA_depose_mussolini }
					ITA_icw_in_progress = yes
					NOT = {
						any_other_country = {
							NOT = {
								tag = ROOT
								tag = FROM
							}
							original_tag = ITA
							exists = yes
						}
					}
				}
				ITF = { country_event = { id = ita_armor.899 } }
				set_global_flag = icw_over
			}
			if = { # Republican victory ICW
				limit = {
					FROM = {
						original_tag = ITA
					}
					has_completed_focus = ITA_depose_mussolini
					ITA_icw_in_progress = yes
					NOT = {
						any_other_country = {
							NOT = {
								tag = ROOT
								tag = FROM
							}
							original_tag = ITA
							exists = yes
						}
					}
				}
				news_event = { id = afo_news.38 days = 1 }
				ITA = { country_event = { id = ita_armor.899 } }
				set_global_flag = icw_over
			}
		}
		effect = {
			if = {
				limit = {
					FROM = {
						original_tag = FRA
					}
					not = {
						has_completed_focus = FRA_action_francaise
					}
				}
				add_threat = 3
				FROM = {
					if = {
						limit = {
							has_template = "Heavy Cell"
						}
						delete_unit_template_and_units = {
							division_template = "Heavy Cell"
							disband = no
						}
					}
					if = {
						limit = {
							has_template = "Light Cell"
						}
						delete_unit_template_and_units = {
							division_template = "Light Cell"
							disband = no
						}
					}
					if = {
						limit = {
							has_template = "Gendarmerie nationale"
						}
						delete_unit_template_and_units = {
							division_template = "Gendarmerie nationale"
							disband = no
						}
					}
				}
				ROOT = {
					if = {
						limit = {
							has_template = "Heavy Cell"
						}
						delete_unit_template_and_units = {
							division_template = "Heavy Cell"
							disband = no
						}
					}
					if = {
						limit = {
							has_template = "Light Cell"
						}
						delete_unit_template_and_units = {
							division_template = "Light Cell"
							disband = no
						}
					}
					if = {
						limit = {
							has_template = "Gendarmerie nationale"
						}
						delete_unit_template_and_units = {
							division_template = "Gendarmerie nationale"
							disband = no
						}
					}
					set_country_flag = FRA_civil_war_over_flag
				}
				FROM = {
					every_unit_leader = {
						set_nationality = ROOT
					}
					add_equipment_to_stockpile = {
						type = motorized_equipment_1
						amount = -100000
						producer = FRA
					}
				}
				every_country = {
					limit = {
						is_subject_of = FROM
					}
					ROOT = {
						set_autonomy = {
							target = prev
							autonomy_state = autonomy_integrated_puppet
						}
					}
				}
			}
		}
		effect = {
			if = {
				limit = {
					FROM = {
						original_tag = FRA
					}
					ROOT = {
						original_tag = FRA
					}
				}
				if = {
					limit = {
						ROOT = {
							tag = FRA
						}
					}
					FROM = {
						transfer_navy = { target = ROOT }
					}
				}
			}
		}
	}

	#ROOT is new controller #FROM is old controller #FROM.FROM is state ID
	on_state_control_changed = {
		effect = {
			if = {
				limit = {
					FROM = {
						has_completed_focus = SOV_great_patriotic_war
					}
					FROM.FROM = {
						is_core_of = FROM
						NOT = { has_state_flag = gpw_state_flag }
					}
				}
				FROM.FROM = { set_state_flag = gpw_state_flag }
				FROM = { army_experience = 5 }
			}
		}
		effect = {
			if = {
				limit = {
					FROM.FROM = {
						state = 28
						NOT = { has_dynamic_modifier = { modifier = FRA_iron_industry_collapse } }
					}
				}
				FROM.FROM = { add_dynamic_modifier = { modifier = FRA_iron_industry_collapse } }
			}
		}
		effect = {
			if = {
				limit = {
					FROM.FROM = {
						has_dynamic_modifier = { modifier = YUG_organized_partisan_activity }
						CONTROLLER = {
							OR = {
								is_in_faction_with = YUG
								tag = YUG
							}
						}
					}
				}
				FROM.FROM = {
					remove_dynamic_modifier = { modifier = YUG_organized_partisan_activity }
				}
			}
		}
		effect = {
			if = {
				limit = {
					FROM.FROM = {
						OR = {
							state = 629
							state = 631
							state = 630
						}
					}
				}
				FROM.FROM = {
					set_state_flag = {
						flag = recent_controller_change
						days = 45
						value = 1
					}
				}
			}
		}
		effect = {
			if = {
				limit = {
					FROM.FROM = {
						has_dynamic_modifier = { modifier = island_province_ai }
						CONTROLLER = {
							is_ai = no
						}
					}
					#ROOT = { NOT = { tag = USA } }
				}
				FROM.FROM = {
					remove_dynamic_modifier = { modifier = island_province_ai }
				}
			}
		}
		effect = {
			if = {
				limit = {
					FROM.FROM = {
						OR = {
							is_one_state_island = yes
							is_island_state = yes
						}
						NOT = {
							has_dynamic_modifier = { modifier = island_province_ai }
						}
						CONTROLLER = {
							is_ai = yes
						}
					}
				}
				FROM.FROM = {
					add_dynamic_modifier = { modifier = island_province_ai }
				}
			}
		}
		effect = {
			if = {
				limit = {
					FROM.FROM = {
						NOT = {
							is_core_of = ROOT
						}
					}
				}
				FROM.FROM = {
					while_loop_effect = {
						limit = {
							steel_refinery > 0
						}
						disable_steel_mill = yes
					}
					while_loop_effect = {
						limit = {
							hydro_steel_refinery > 0
						}
						disable_hydro_steel_mill = yes
					}
					while_loop_effect = {
						limit = {
							aluminium_refinery > 0
						}
						disable_aluminium_mill = yes
					}
					while_loop_effect = {
						limit = {
							hydro_aluminium_refinery > 0
						}
						disable_hydro_aluminium_mill = yes
					}

				}
			}
		}
		effect = {
			if = {
				limit = {
					has_global_flag = HUN_limited_war_states_@FROM
					ROOT = {
						tag = HUN
					}
					FROM = {
						is_in_faction = no
					}
				}
				if = {
					limit = {
						FROM = {
							tag = ROM
						}
						ROOT = {
							controls_state = 76
							controls_state = 83
							controls_state = 84
							controls_state = 92
							controls_state = 80
						}
					}
					clr_global_flag = HUN_limited_war_states_@FROM
					FROM = {
						white_peace = ROOT
						add_ai_strategy = {
							type = diplo_action_acceptance
							id = ENG
							value = 100
							target = join_allies
						}
						add_ai_strategy = {
							type = diplo_action_acceptance
							id = GER
							value = 100
							target = join_allies
						}
						add_ai_strategy = {
							type = diplo_action_acceptance
							id = ITA
							value = 100
							target = join_allies
						}
						add_ai_strategy = {
							type = diplo_action_acceptance
							id = FRA
							value = 100
							target = join_allies
						}
						set_truce = {
							target = ROOT
							days = 90
						}
					}
					transfer_state = 76
					transfer_state = 83
					transfer_state = 84
					transfer_state = 92
					transfer_state = 80
				}
				else_if = {
					limit = {
						FROM = {
							tag = YUG
						}
						ROOT = {
							controls_state = 102
							controls_state = 887
							controls_state = 888
							controls_state = 103
							controls_state = 908
							controls_state = 109
							controls_state = 104
							controls_state = 45
							controls_state = 163
							controls_state = 764
							controls_state = 45
						}
					}
					clr_global_flag = HUN_limited_war_states_@FROM
					FROM = {
						white_peace = ROOT
						add_ai_strategy = {
							type = diplo_action_acceptance
							id = ENG
							value = 100
							target = join_allies
						}
						add_ai_strategy = {
							type = diplo_action_acceptance
							id = GER
							value = 100
							target = join_allies
						}
						add_ai_strategy = {
							type = diplo_action_acceptance
							id = ITA
							value = 100
							target = join_allies
						}
						add_ai_strategy = {
							type = diplo_action_acceptance
							id = FRA
							value = 100
							target = join_allies
						}
						set_truce = {
							target = ROOT
							days = 90
						}
					}
					transfer_state = 102
					transfer_state = 887
					transfer_state = 888
					transfer_state = 103
					transfer_state = 908
					transfer_state = 109
					transfer_state = 104
					transfer_state = 45
					transfer_state = 163
					transfer_state = 764
					transfer_state = 45
				}
				else_if = {
					limit = {
						FROM = {
							tag = ITA
						}
						ROOT = {
							controls_state = 736
							controls_state = 885
							controls_state = 886
							controls_state = 39
						}
					}
					clr_global_flag = HUN_limited_war_states_@FROM
					FROM = {
						white_peace = ROOT
						add_ai_strategy = {
							type = diplo_action_acceptance
							id = ENG
							value = 100
							target = join_allies
						}
						add_ai_strategy = {
							type = diplo_action_acceptance
							id = GER
							value = 100
							target = join_allies
						}
						add_ai_strategy = {
							type = diplo_action_acceptance
							id = ITA
							value = 100
							target = join_allies
						}
						add_ai_strategy = {
							type = diplo_action_acceptance
							id = FRA
							value = 100
							target = join_allies
						}
						set_truce = {
							target = ROOT
							days = 90
						}
					}
					transfer_state = 736
					transfer_state = 885
					transfer_state = 886
					transfer_state = 39
				}
				else_if = {
					limit = {
						FROM = {
							tag = POL
						}
						ROOT = {
							controls_state = 88
							controls_state = 893
							controls_state = 89
							controls_state = 91
						}
					}
					clr_global_flag = HUN_limited_war_states_@FROM
					FROM = {
						white_peace = ROOT
						add_ai_strategy = {
							type = diplo_action_acceptance
							id = ENG
							value = 100
							target = join_allies
						}
						add_ai_strategy = {
							type = diplo_action_acceptance
							id = GER
							value = 100
							target = join_allies
						}
						add_ai_strategy = {
							type = diplo_action_acceptance
							id = ITA
							value = 100
							target = join_allies
						}
						add_ai_strategy = {
							type = diplo_action_acceptance
							id = FRA
							value = 100
							target = join_allies
						}
						set_truce = {
							target = ROOT
							days = 90
						}
					}
					transfer_state = 88
					transfer_state = 893
					transfer_state = 89
					transfer_state = 91
				}
			}
		}
		effect = {
			if = {
				limit = {
					FROM.FROM = {
						OR = {
							state = 6
							state = 34
							state = 790
							state = 979
							state = 985
						}
					}
				}
				FROM.FROM = {
					remove_dynamic_modifier = { modifier = semi_autonomous_state }
				}
			}
		}
		#effect = {
		#	if = {
		#		limit = {
		#			FROM.FROM = {
		#				has_dynamic_modifier = { modifier = FIN_motti_tactics }
		#			}
		#			ROOT = { NOT = { tag = FIN } }
		#		}
		#		FROM.FROM = {
		#			remove_dynamic_modifier = { modifier = FIN_motti_tactics }
		#		}
		#	}
		#}
		effect = {
			if = {
				limit = {
					FROM.FROM = {
						has_state_flag = ITL_oil_flag
					}
					ROOT = { NOT = { is_subject_of = ITA } }
				}
				662 = { clr_state_flag = ITL_oil_flag }
				ITA = {
					remove_resource_rights = 662
				}
			}
		}
		effect = {
			if = {
				limit = {
					FROM.FROM = {
						has_state_flag = ITL_oil_flag_2
					}
					ROOT = { NOT = { is_subject_of = ITA } }
				}
				450 = { clr_state_flag = ITL_oil_flag_2 }
				ITA = {
					remove_resource_rights = 450
				}
			}
		}
		effect = {
			if = {
				limit = {
					FROM.FROM = {
						has_state_flag = ITE_oil_flag
					}
					ROOT = { NOT = { is_subject_of = ITA } }
				}
				457 = { clr_state_flag = ITE_oil_flag }
				ITA = {
					remove_resource_rights = 457
				}
			}
		}
		effect = {
			if = {
				limit = {
					FROM.FROM = {
						has_state_flag = RKA_oil_flag
					}
					ROOT = { NOT = { is_subject_of = GER } }
				}
				229 = { clr_state_flag = RKA_oil_flag }
				232 = { clr_state_flag = RKA_oil_flag }
				234 = { clr_state_flag = RKA_oil_flag }
				GER = {
					remove_resource_rights = 229
					remove_resource_rights = 232
					remove_resource_rights = 234
				}
			}
		}
		effect = {
			if = {
				limit = {
					FROM.FROM = {
						has_state_flag = RNO_iron_flag
					}
					ROOT = { NOT = { is_subject_of = GER } }
				}
				144 = { clr_state_flag = RNO_iron_flag }
				GER = {
					remove_resource_rights = 144
				}
			}
		}
		effect = {
			if = {
				limit = {
					FROM.FROM = {
						has_state_flag = RSW_iron_flag
					}
					ROOT = { NOT = { is_subject_of = GER } }
				}
				666 = { clr_state_flag = RSW_iron_flag }
				GER = {
					remove_resource_rights = 666
				}
			}
		}
		effect = {
			if = {
				limit = {
					FROM.FROM = {
						has_state_flag = RFR_iron_flag
					}
					ROOT = { NOT = { is_subject_of = GER } }
				}
				17 = { clr_state_flag = RFR_iron_flag }
				GER = {
					remove_resource_rights = 17
				}
			}
		}
		effect = {
			if = {
				limit = {
					FROM.FROM = {
						has_state_flag = REN_iron_flag
					}
					ROOT = { NOT = { is_subject_of = GER } }
				}
				859 = { clr_state_flag = REN_iron_flag }
				122 = { clr_state_flag = REN_iron_flag }
				129 = { clr_state_flag = REN_iron_flag }
				130 = { clr_state_flag = REN_iron_flag }
				GER = {
					remove_resource_rights = 859
					remove_resource_rights = 122
					remove_resource_rights = 129
					remove_resource_rights = 130
				}
			}
		}
		effect = {
			if = {
				limit = {
					FROM.FROM = {
						has_state_flag = MAN_iron_flag
					}
					ROOT = { NOT = { is_subject_of = JAP } }
				}
				716 = { clr_state_flag = MAN_iron_flag }
				JAP = {
					remove_resource_rights = 716
				}
			}
		}
		effect = {
			if = {
				limit = {
					FROM.FROM = {
						has_state_flag = RNC_iron_flag
					}
					ROOT = { NOT = { is_subject_of = JAP } }
				}
				597 = { clr_state_flag = RNC_iron_flag }
				615 = { clr_state_flag = RNC_iron_flag }
				925 = { clr_state_flag = RNC_iron_flag }
				606 = { clr_state_flag = RNC_iron_flag }
				JAP = {
					remove_resource_rights = 597
					remove_resource_rights = 615
					remove_resource_rights = 925
					remove_resource_rights = 606
				}
			}
		}
		effect = {
			if = {
				limit = {
					FROM.FROM = {
						has_state_flag = RNC_tungsten_flag
					}
					ROOT = { NOT = { is_subject_of = JAP } }
				}
				595 = { clr_state_flag = RNC_tungsten_flag }
				938 = { clr_state_flag = RNC_tungsten_flag }
				593 = { clr_state_flag = RNC_tungsten_flag }
				592 = { clr_state_flag = RNC_tungsten_flag }
				602 = { clr_state_flag = RNC_tungsten_flag }
				934 = { clr_state_flag = RNC_tungsten_flag }
				599 = { clr_state_flag = RNC_tungsten_flag }
				932 = { clr_state_flag = RNC_tungsten_flag }
				594 = { clr_state_flag = RNC_tungsten_flag }
				JAP = {
					remove_resource_rights = 595
					remove_resource_rights = 938
					remove_resource_rights = 593
					remove_resource_rights = 592
					remove_resource_rights = 602
					remove_resource_rights = 934
					remove_resource_rights = 599
					remove_resource_rights = 932
					remove_resource_rights = 594
				}
			}
		}
		effect = {
			if = {
				limit = {
					FROM.FROM = {
						has_state_flag = IPM_rubber_flag
					}
					ROOT = { NOT = { is_subject_of = JAP } }
				}
				597 = { clr_state_flag = IPM_rubber_flag }
				615 = { clr_state_flag = IPM_rubber_flag }
				JAP = {
					remove_resource_rights = 597
					remove_resource_rights = 615
				}
			}
		}
		effect = {
			if = {
				limit = {
					FROM.FROM = {
						has_state_flag = IPI_oil_flag
					}
					ROOT = { NOT = { is_subject_of = JAP } }
				}
				334 = { clr_state_flag = IPI_oil_flag }
				335 = { clr_state_flag = IPI_oil_flag }
				672 = { clr_state_flag = IPI_oil_flag }
				JAP = {
					remove_resource_rights = 334
					remove_resource_rights = 335
					remove_resource_rights = 672
				}
			}
		}
		effect = {
			if = {
				limit = {
					FROM.FROM = {
						has_state_flag = SIA_rubber_flag
					}
					ROOT = { NOT = { is_subject_of = JAP } }
				}
				724 = { clr_state_flag = SIA_rubber_flag }
				JAP = {
					remove_resource_rights = 724
				}
			}
		}
		effect = {
			if = {
				limit = {
					ROOT = { NOT = { tag = RAJ } }
					FROM.FROM = {
						RAJ_has_pakistan_state_modifier = yes
						has_dynamic_modifier = { modifier = marginalized_muslim_community_state }
					}
				}
				FROM.FROM = {
					remove_dynamic_modifier = { modifier = marginalized_muslim_community_state }
					set_state_flag = RAJ_pakistan_state_conquered
				}
			}
		}
		effect = {
			if = {
				limit = {
					ROOT = { NOT = { tag = RAJ } }
					FROM.FROM = {
						RAJ_has_pakistan_state_modifier = yes
						has_dynamic_modifier = { modifier = marginalized_muslim_community_state_happy }
					}
				}
				FROM.FROM = {
					remove_dynamic_modifier = { modifier = marginalized_muslim_community_state_happy }
					set_state_flag = RAJ_pakistan_state_conquered
				}
			}
		}
		effect = {
			if = {
				limit = {
					ROOT = { NOT = { tag = RAJ } }
					FROM.FROM = {
						RAJ_has_pakistan_state_modifier = yes
						has_dynamic_modifier = { modifier = marginalized_muslim_community_state_angry }
					}
				}
				FROM.FROM = {
					remove_dynamic_modifier = { modifier = marginalized_muslim_community_state_angry }
					set_state_flag = RAJ_pakistan_state_conquered
				}
			}
		}
		effect = {
			if = {
				limit = {
					ROOT = { NOT = { tag = RAJ } }
					FROM.FROM = {
						RAJ_has_inc_state_modifier = yes
						has_dynamic_modifier = { modifier = indian_national_congress_state }
					}
				}
				FROM.FROM = {
					remove_dynamic_modifier = { modifier = indian_national_congress_state }
					set_state_flag = RAJ_indian_state_conquered
				}
			}
		}
		effect = {
			if = {
				limit = {
					ROOT = { NOT = { tag = RAJ } }
					FROM.FROM = {
						RAJ_has_princley_state_modifier = yes
						has_dynamic_modifier = { modifier = princley_state }
					}
				}
				FROM.FROM = {
					remove_dynamic_modifier = { modifier = princley_state }
					set_state_flag = RAJ_indian_state_conquered
				}
			}
		}
		effect = {
			if = {
				limit = {
					ROOT = { NOT = { tag = RAJ } }
					FROM.FROM = {
						RAJ_has_princley_state_modifier = yes
						has_dynamic_modifier = { modifier = princley_state_happy }
					}
				}
				FROM.FROM = {
					remove_dynamic_modifier = { modifier = princley_state_happy }
					set_state_flag = RAJ_indian_state_conquered
				}
			}
		}
		effect = {
			if = {
				limit = {
					ROOT = { NOT = { tag = RAJ } }
					FROM.FROM = {
						RAJ_has_hm_state_modifier = yes
						has_dynamic_modifier = { modifier = hm_state }
					}
				}
				FROM.FROM = {
					remove_dynamic_modifier = { modifier = hm_state }
					set_state_flag = RAJ_indian_state_conquered
				}
			}
		}
		effect = {
			if = {
				limit = {
					TAG = GER
					GER = { has_government = fascism }
					has_war_with = DEN
					date < 1942.1.1
					DEN = { has_government = democratic }
					DEN = { has_capitulated = no }
					OR = {
						NOT = {
							871 = { is_fully_controlled_by = DEN }
						}
						NOT = {
							99 = { is_fully_controlled_by = DEN }
						}
						NOT = {
							37 = { is_fully_controlled_by = DEN }
						}
						NOT = {
							1051 = { is_fully_controlled_by = DEN }
						}
					}
					# 37 = { is_owned_by = DEN }
					# 37 = { is_controlled_by = GER }
					58 = { is_controlled_by = GER }
					803 = { is_controlled_by = GER }
					59 = { is_controlled_by = GER }
					61 = { is_controlled_by = GER }
					56 = { is_controlled_by = GER }
					62 = { is_controlled_by = GER }
					OR = {
						AND = {
							GER = { has_war_with = POL }
							POL = { has_capitulated = yes }
						}
						AND = {
							GER = { has_war_with = CZE }
							CZE = { has_capitulated = yes }
						}
						AND = {
							GER = { has_war_with = HOL }
							HOL = { has_capitulated = yes }
						}
						AND = {
							GER = { has_war_with = BEL }
							BEL = { has_capitulated = yes }
						}
						AND = {
							GER = { has_war_with = ROM }
							ROM = { has_capitulated = yes }
						}
						AND = {
							GER = { has_war_with = FRA }
							FRA = { has_capitulated = yes }
						}
						AND = {
							GER = { has_war_with = ENG }
							ENG = { has_capitulated = yes }
						}
						AND = {
							GER = { has_war_with = NOR }
							NOR = { has_capitulated = yes }
						}
						AND = {
							GER = { has_war_with = SWE }
							SWE = { has_capitulated = yes }
						}
					}
				}
				DEN = { country_event = { id = den_armor.5 } }
			}
		}
		effect = {
			if = {
				limit = {
					SOV = { has_government = communism }
					ENG = { has_government = democratic }
					SOV = { has_war_with = PER }
					ENG = { has_war_with = PER }
					PER = { surrender_progress > 0.01 }
					NOT = { ENG = { has_war_with = SOV } }
				}
				PER = { country_event = { id = per_armor.1 days = 14 } }
			}
		}
		effect = {
			if = {
				limit = {
					has_global_flag = FRA_monarchist_civil_war_flag
					root = {
						tag = FRA
						is_ai = no
						not = {
							has_country_flag = FRA_paris_has_happened
						}
					}
					FROM.FROM = {
						state = 855
					}
				}
				set_country_flag = FRA_paris_has_happened
				root = {
					country_event = fra_monarchist.009
				}
			}
		}
	}

	on_government_exiled = {
		effect = {
			add_ideas = exiled_economy
		}
		effect = {
			if = {
				limit = {
					NOT = { has_idea = volunteer_only }
				}
				add_ideas = volunteer_only
			}
		}
	}

	on_exile_government_reinstated = {
		effect = {
			if = {
				limit = {
					has_idea = exiled_economy
				}
				add_ideas = civilian_economy
			}
		}
	}

	on_weekly = {
		effect = {
			if = {
				limit = {
					is_ai = yes
					not = {has_country_flag = trade_fix_ai_strat}
				}
				if = {
					limit = {
						not = {has_tech = trade_fix_tech}
					}
					set_technology = { trade_fix_tech = 1 popup = no }
				}
				set_country_flag = trade_fix_ai_strat
				add_equipment_production = {
					equipment = {
						type = trade_fix_equipment_0
					}
					requested_factories = 1
					progress = 0.65
					amount = 1
				}
				add_offsite_building = { type = dockyard level = 1 }
			}
		}

		#player resource managment
		effect = {
			if = {
				limit = {
					is_ai = no
				}
				recalculate_steel_mills = yes
				recalculate_alu_mills = yes
				recalculate_synth = yes
				manage_steel_mills = yes
				manage_alu_mills = yes
				manage_synth = yes
				calculate_resource_deficite = yes
			}
		}
	}
	on_weekly_SOV = {
		effect = {
			if = {
				limit = { has_variable = greatest_airforce_tac }

				set_variable = { sov_cur_tac = num_deployed_planes_with_type@medium_heavy_bomber_airframe }
				set_variable = { greatest_airforce_tac = sov_cur_tac }

				set_variable = { sov_cur_str = num_deployed_planes_with_type@medium_bomber_airframe }
				add_to_variable = { greatest_airforce_tac = sov_cur_str }

				set_variable = { greatest_airforce_fighters = num_deployed_planes_with_type@small_fighter_airframe }
				add_to_variable = { greatest_airforce_fighters = num_deployed_planes_with_type@small_fighter_multirole_airframe }
				add_to_variable = { greatest_airforce_fighters = num_deployed_planes_with_type@small_fighter_interceptor_airframe }
			}
		}
	}
	on_daily_GER = {
		effect = {
			if = {
				limit = {
					NOT = { has_global_flag = tech_tree_startup_flag  }
				}
				set_global_flag = tech_tree_startup_flag
			}
		}
	}
	on_daily_SOV = {
		# Soviet Winter War calculation
		effect = {
			if = {
				limit = { has_global_flag = WA_winter_war_flag }
				SOV = {
					add_to_variable = { SOV_winter_war_impatience_variable = 0.5 }
					clamp_variable = {
						var = SOV_winter_war_impatience_variable
						max = 100
					}

					set_temp_variable = { temp_impatience = SOV_winter_war_impatience_variable}
					divide_temp_variable = { temp_impatience = 100}

					set_variable = { SOV_winter_war_pp_variable = temp_impatience}
				}
			}
		}
	}
	on_weekly_FRA = {
		effect = {
			if = {
				limit = {
					OR = {
						has_active_mission = FRA_modernize_airforce_mission
						NOT = { has_completed_focus = FRA_the_arsenal_de_laeronautique}
					}
				}

				set_variable = { french_figthers = num_deployed_planes_with_type@small_fighter_airframe}
				add_to_variable = {french_figthers = num_deployed_planes_with_type@small_fighter_multirole_airframe }

				set_variable = {french_bombers = num_deployed_planes_with_type@medium_heavy_bomber_airframe}
				add_to_variable = { french_bombers = num_deployed_planes_with_type@large_bomber_airframe}

				set_variable = { fra_cur_atac = num_deployed_planes_with_type@medium_fighter_multirole_airframe }
				set_variable = { french_attackers = fra_cur_atac }

				set_variable = { french_heavy_plane = num_deployed_planes_with_type@medium_fighter_airframe }
				add_to_variable = { french_heavy_plane = fra_cur_atac }

				set_variable = { fra_cur_cas = num_deployed_planes_with_type@small_bomber_airframe }
				add_to_variable = { french_attackers = fra_cur_cas }
			}
		}
		effect = {
			if = {
				limit = {
					has_active_mission = FRA_modernize_navy_mission
				}

				set_variable = { fra_sub_var = num_ships_with_type@submarine }
				add_to_variable = {fra_sub_varnch_figthers = num_ships_with_type@cruiser_submarine }
			}
		}
		effect = {
			if = {
				limit = {
					has_global_flag = fall_of_france
					OR = {
						has_war_with = FRC
						has_war_with = FRW
						has_war_with = FRM
						has_war_with = FRN
						has_war_with = FRS
						has_war_with = FRJ
					}
				}
				if = {
					limit = {
						has_war_with = FRC
					}
					FRC = {
						country_event = {
							id = fra_armor.2021
							hours = 6
						}
					}

				}
				if = {
					limit = {
						has_war_with = FRW
					}
					FRW = {
						country_event = {
							id = fra_armor.2021
							hours = 6
						}
					}
				}
				if = {
					limit = {
						has_war_with = FRM
					}
					FRM = {
						country_event = {
							id = fra_armor.2021
							hours = 6
						}
					}
				}
				if = {
					limit = {
						has_war_with = FRN
					}
					FRN = {
						country_event = {
							id = fra_armor.2021
							hours = 6
						}
					}
				}
				if = {
					limit = {
						has_war_with = FRS
					}
					FRS = {
						country_event = {
							id = fra_armor.2021
							hours = 6
						}
					}
				}
				if = {
					limit = {
						has_war_with = FRJ
					}
					FRJ = {
						country_event = {
							id = fra_armor.2021
							hours = 6
						}
					}
				}
			}
		}
	}
	on_daily_ENG = {
		#limited invasions
		effect = { #denmark
			if = {
				limit = {
					has_country_flag = ENG_island_limited_invasion_den
				}
				if = {
					limit = {
						OR = {
							AND = {
								controls_province = 12512
								controls_state = 337
								controls_state = 100
							}
							DEN = {
								surrender_progress > 0.1
							}
						}
					}
					annex_country = {
						target = ICE
					}
					annex_country = {
						target = DEG
					}
					every_country = {
						limit = {
							is_in_faction_with = DEN
						}
						ENG = {
							white_peace = PREV
						}

					}
					white_peace = DEN
					ENG = {
						clr_country_flag = ENG_island_limited_invasion_den
					}
				}
			}
		}
		effect = { #crete
			if = {
				limit = {
					has_country_flag = ENG_island_limited_invasion_cre
				}
				if = {
					limit = {
						OR = {
							controls_state = 182
							182 = {
								owner = {
									surrender_progress > 0.1
								}
							}
						}
					}
					182 = {
						owner = {
							every_country = {
								limit = {
									is_in_faction_with = prev
								}
								ENG = {
									white_peace = prev
								}
							}
							ENG = {
								white_peace = prev
							}
						}
						transfer_state_to = ENG
					}
					ENG = {
						clr_country_flag = ENG_island_limited_invasion_cre
					}
				}
			}
		}
		effect = { #balearic
			if = {
				limit = {
					has_country_flag = ENG_island_limited_invasion_bal
				}
				if = {
					limit = {
						OR = {
							controls_state = 177
							177 = {
								owner = {
									surrender_progress > 0.1
								}
							}
						}
					}
					177 = {
						owner = {
							every_country = {
								limit = {
									is_in_faction_with = prev
								}
								ENG = {
									white_peace = prev
								}
							}
							ENG = {
								white_peace = prev
							}
						}
						transfer_state_to = ENG
					}
					ENG = {
						clr_country_flag = ENG_island_limited_invasion_bal
					}
				}
			}
		}
		effect = { #portugal
			if = {
				limit = {
					has_country_flag = ENG_island_limited_invasion_por
				}
				if = {
					limit = {
						OR = {
							AND = {
								679 = {
									OR = {
										is_controlled_by = ENG
										owner = {
											NOT = { TAG = POR }
										}
									}
								}
								698 = {
									OR = {
										is_controlled_by = ENG
										owner = {
											NOT = { TAG = POR }
										}
									}
								}
								702 = {
									OR = {
										is_controlled_by = ENG
										owner = {
											NOT = { TAG = POR }
										}
									}
								}
							}
							POR = {
								surrender_progress > 0.1
							}
						}
					}
					transfer_state = 679
					transfer_state = 698
					transfer_state = 702
					every_country = {
						limit = {
							is_in_faction_with = POR
						}
						ENG = {
							white_peace = PREV
						}

					}
					white_peace = POR
					ENG = {
						clr_country_flag = ENG_island_limited_invasion_por
					}
				}
			}
		}
	}
	on_daily_FRA = {
		effect = {
			if = {
				limit = {
					has_country_flag = steel_contract_ongoing
				}

				20 = {
					set_variable = { steel_mills_now = building_level@steel_refinery}
					add_to_variable = { steel_mills_now = building_level@steel_refinery_inactive}
				}
				27 = {
					set_variable = { steel_mills_now = building_level@steel_refinery}
					add_to_variable = { steel_mills_now = building_level@steel_refinery_inactive}
				}
			}
		}
		effect = {
			if = {
				limit = { has_variable = promote_tanks_mission }

				set_variable = { fra_cur_mt = num_equipment_in_armies@medium_tank_chassis }
				set_variable = { promote_tanks_mission = fra_cur_mt }

				set_variable = { fra_cur_hv = num_equipment_in_armies@heavy_tank_chassis }
				set_variable = { promote_tanks_mission = fra_cur_hv }
			}
		}
		effect = {
			if = {
				limit = {
					GER = {
						has_government = fascism
						has_war_with = FRA
					}
					NOT = { has_global_flag = fall_of_france }
				}
				if = {
					limit = {
						FRA = {
							OR = {
								has_idea = FRA_disjointed_government
								has_idea = FRA_disjointed_government_2
								has_idea = FRA_disjointed_government_3
							}
						}

						29 = { is_controlled_by = GER }
						785 = { is_controlled_by = GER }
						18 = { is_controlled_by = GER }
						GER = {
							OR = {
								controls_province = 6569
								controls_province = 6585
								controls_province = 9561
								controls_province = 11518
								controls_province = 13855
								controls_province = 6949
							}
						}
						855 = { is_controlled_by = FRA }
						OR = {
							NOT = { FRA = { is_in_faction_with = BEL } }
							AND = {
								FRA = { is_in_faction_with = BEL }
								BEL = { has_capitulated = yes }
							}
						}
					}
					FRA = { country_event = { id = fra_armor.804 } }
				}
			}
		}
	}
	on_weekly_GER = {
		effect = {
			if = {
				limit = { has_variable = creation_of_the_panzer_core_tanks }

				set_variable = { ger_cur_lt = num_equipment_in_armies@light_tank_chassis }
				set_variable = { creation_of_the_panzer_core_tanks = ger_cur_lt }

				set_variable = { ger_cur_mt = num_equipment_in_armies@medium_tank_chassis }
				add_to_variable = { creation_of_the_panzer_core_tanks = ger_cur_mt }

				set_variable = { ger_cur_ist = num_equipment_in_armies@medium_tank_infantry_support_chassis }
				add_to_variable = { creation_of_the_panzer_core_tanks = ger_cur_ist }
			}
			if = {
				limit = {
					is_ai = yes
					tag = GER
					has_war_with = SOV
					date > 1941.10.1
					date < 1945.4.1
				}
				if = {
					limit = {
						has_equipment = { infantry_equipment < 1000 }
					}
					add_equipment_to_stockpile = {
						type = infantry_equipment
						producer = GER
						amount = 40000
					}
				}
				if = {
					limit = {
						has_equipment = { support_equipment < 1000 }
					}
					add_equipment_to_stockpile = {
						type = support_equipment
						producer = GER
						amount = 35000
					}
				}
				if = {
					limit = {
						has_equipment = { heavy_infantry_equipment < 1000 }
					}
					add_equipment_to_stockpile = {
						type = heavy_infantry_equipment
						producer = GER
						amount = 30000
					}
				}
				if = {
					limit = {
						has_equipment = { artillery_equipment < 100 }
					}
					add_equipment_to_stockpile = {
						type = artillery_equipment
						producer = GER
						amount = 3000
					}
				}
				if = {
					limit = {
						has_equipment = { heavy_artillery_equipment < 100 }
					}
					add_equipment_to_stockpile = {
						type = heavy_artillery_equipment
						producer = GER
						amount = 3000
					}
				}
				if = {
					limit = {
						has_equipment = { mechanized_equipment < 100 }
					}
					add_equipment_to_stockpile = {
						type = mechanized_equipment
						producer = GER
						amount = 1000
					}
				}
				if = {
					limit = {
						has_equipment = { heavy_anti_air_equipment < 100 }
					}
					add_equipment_to_stockpile = {
						type = heavy_anti_air_equipment
						producer = GER
						amount = 2000
					}
				}
				if = {
					limit = {
						has_equipment = { anti_tank_equipment < 100 }
					}
					add_equipment_to_stockpile = {
						type = anti_tank_equipment
						producer = GER
						amount = 3000
					}
				}
				if = {
					limit = {
						has_equipment = { medium_tank_chassis < 100 }
					}
					add_equipment_to_stockpile = {
						type = medium_tank_chassis
						producer = GER
						amount = 500
					}
				}
				if = {
					limit = {
						has_tech = ger_modern_tank_chassis_1
						has_equipment = { modern_tank_chassis < 100 }
					}
					add_equipment_to_stockpile = {
						type = modern_tank_chassis
						producer = GER
						amount = 500
					}
				}
			}
		}
	}
	on_weekly_ENG = {
		effect = {
			if = {
				limit = { has_variable = creation_of_the_armoured_corps_tanks }

				set_variable = { eng_cur_ht = num_equipment_in_armies@heavy_tank_chassis }
				set_variable = { creation_of_the_armoured_corps_tanks = eng_cur_ht }

				set_variable = { eng_cur_mt = num_equipment_in_armies@medium_tank_chassis }
				add_to_variable = { creation_of_the_armoured_corps_tanks = eng_cur_mt }

				set_variable = { eng_cur_st = num_equipment_in_armies@medium_tank_support_chassis }
				add_to_variable = { creation_of_the_armoured_corps_tanks = eng_cur_st }

				set_variable = { eng_cur_lt = num_equipment_in_armies@light_tank_chassis }
				add_to_variable = { creation_of_the_armoured_corps_tanks = eng_cur_lt }

				set_variable = { eng_cur_mist = num_equipment_in_armies@medium_tank_infantry_support_chassis }
				add_to_variable = { creation_of_the_armoured_corps_tanks = eng_cur_mist }

				set_variable = { eng_cur_hist = num_equipment_in_armies@heavy_tank_infantry_support_chassis }
				add_to_variable = { creation_of_the_armoured_corps_tanks = eng_cur_hist }
			}
		}
		effect = {
			if = {
				limit = { has_active_mission = ENG_modernization_of_the_royal_airforce }

				set_variable = { eng_mod_tac = num_deployed_planes_with_type@medium_heavy_bomber_airframe }
				set_variable = { ENG_modernization_of_the_royal_airforce_bombers = eng_mod_tac }

				set_variable = { eng_mod_str = num_deployed_planes_with_type@medium_bomber_airframe }
				add_to_variable = { ENG_modernization_of_the_royal_airforce_bombers = eng_mod_str }

				set_variable = { eng_mod_pat = num_deployed_planes_with_type@large_maritime_patrol_airframe }
				add_to_variable = { ENG_modernization_of_the_royal_airforce_bombers = eng_mod_pat }

				set_variable = { ENG_modernization_of_the_royal_airforce_fighters = num_deployed_planes_with_type@small_fighter_airframe }
				add_to_variable = { ENG_modernization_of_the_royal_airforce_fighters = num_deployed_planes_with_type@small_fighter_multirole_airframe }
				add_to_variable = { ENG_modernization_of_the_royal_airforce_fighters = num_deployed_planes_with_type@small_fighter_interceptor_airframe }
				add_to_variable = { ENG_modernization_of_the_royal_airforce_fighters = num_deployed_planes_with_type@cv_small_fighter_airframe }
			}
		}
		effect = {
			if = {
				limit = { has_active_mission = ENG_rejuvenate_the_royal_navy }

				set_variable = { ENG_royal_navy_carriers = num_ships_with_type@carrier }
				subtract_from_variable = { ENG_royal_navy_carriers = num_ships_with_type@light_carrier }

				set_variable = { ENG_royal_navy_submarines = num_ships_with_type@submarine }
				subtract_from_variable = { ENG_royal_navy_submarines = num_ships_with_type@cruiser_submarine }
			}
		}
	}
	on_weekly_ITA = {
		effect = {
			if = {
				limit = { has_variable = modernization_of_the_Regio_esercito_tanks }

				set_variable = { ita_cur_lt = num_equipment_in_armies@light_tank_chassis }
				set_variable = { modernization_of_the_Regio_esercito_tanks = ita_cur_lt }

				set_variable = { ita_cur_mt = num_equipment_in_armies@medium_tank_chassis }
				add_to_variable = { modernization_of_the_Regio_esercito_tanks = ita_cur_mt }
			}
		}
		effect = {
			if = {
				limit = { has_variable = ITA_modernization_of_the_regio_aeronautica }

				set_variable = { ita_cur_tac = num_deployed_planes_with_type@medium_heavy_bomber_airframe }
				set_variable = { ITA_modernization_of_the_regio_aeronautica = ita_cur_tac }

				set_variable = { ita_cur_str = num_deployed_planes_with_type@medium_bomber_airframe }
				add_to_variable = { ITA_modernization_of_the_regio_aeronautica = ita_cur_str }
			}
		}
		effect = {
			if = {
				limit = { has_variable = ITA_modernization_of_the_regio_marina }

				set_variable = { ITA_modernization_of_the_regio_marina = num_ships_with_type@submarine }
				subtract_from_variable = { ITA_modernization_of_the_regio_marina = num_ships_with_type@cruiser_submarine }
			}
		}
		effect = {
			if = {
				limit = {
					has_country_flag = allies_accept_peace_flag
				}
				if = {
					limit = {
						any_state = {
							is_core_of = ROOT
							or = {
								region = 21
								region = 23
								region = 238
							}
							not = {
								is_fully_controlled_by = ROOT
								state = 115
							}
						}
					}
					ITA = { country_event = ita_armor.897 }
					clr_country_flag = allies_accept_peace_flag
				}
			}
		}
	}
	on_weekly_USA = {
		effect = {
			if = {
				limit = {
					OR = {
						has_idea = USA_FY42_plan
						has_idea = USA_FY40_plan
					}
				}
				set_variable = { usa_plan_cv = num_ships_with_type@carrier }
				subtract_from_variable = { usa_plan_cv = num_ships_with_type@light_carrier }
			}
		}
		effect = {
			if = {
				limit = {
					has_idea = USA_FY42_plan
				}
				set_variable = {
					new_total_light_ships = num_ships_with_type@destroyer
				}
				add_to_variable = {
					new_total_light_ships = num_ships_with_type@frigate
				}
				set_variable = {
					total_light_ships = new_total_light_ships
				}
				if = {
					limit = {
						has_navy_size = {
							size > fy_cv
							archetype = ship_hull_carrier
						}
					}
					set_country_flag = fy44_cv_done
				}
				if = {
					limit = {
						has_navy_size = {
							size > fy_cvl
							archetype = ship_hull_light_carrier
						}
					}
					set_country_flag = fy44_cvl_done
				}
				if = {
					limit = {
						has_navy_size = {
							size > fy_ca
							archetype = ship_hull_heavy_cruiser
						}
					}
					set_country_flag = fy44_ca_done
				}
				if = {
					limit = {
						has_navy_size = {
							size > fy_cl
							archetype = ship_hull_cruiser
						}
					}
					set_country_flag = fy44_cl_done
				}
				if = {
					limit = {
						check_variable = {
							total_light_ships > required_light_ships
						}
					}
					set_country_flag = fy44_light_done
				}
				if = {
					limit = {
						has_navy_size = {
							size > fy_sc
							archetype = sub_hull_cruiser_submarine
						}
					}
					set_country_flag = fy44_sc_done
				}
			}
		}
		effect = {
			if = {
				limit = {
					has_idea = USA_FY40_plan
				}
				if = {
					limit = {
						has_navy_size = {
							size > fy_cv
							archetype = ship_hull_carrier
						}
					}
					set_country_flag = fy40_cv_done
				}
				if = {
					limit = {
						has_navy_size = {
							size > fy_bb
							archetype = ship_hull_heavy_battleship
						}
					}
					set_country_flag = fy40_bb_done
				}
				if = {
					limit = {
						has_navy_size = {
							size > fy_ca
							archetype = ship_hull_heavy_cruiser
						}
					}
					set_country_flag = fy40_ca_done
				}
				if = {
					limit = {
						has_navy_size = {
							size > fy_cl
							archetype = ship_hull_cruiser
						}
					}
					set_country_flag = fy40_cl_done
				}
				if = {
					limit = {
						has_navy_size = {
							size > fy_dd
							archetype = ship_hull_light
						}
					}
					set_country_flag = fy40_dd_done
				}
				if = {
					limit = {
						has_navy_size = {
							size > fy_sc
							archetype = sub_hull_cruiser_submarine
						}
					}
					set_country_flag = fy40_sc_done
				}
			}
		}
	#	effect = {
	#		if = {
	#			limit = { has_active_mission = USA_revitalize_the_airforce }
	#
	#			set_variable = { usa_rev_tac = num_deployed_planes_with_type@tac_bomber_equipment }
	#			set_variable = { USA_revitalize_the_airforce_bombers = usa_rev_tac }
	#
	#			set_variable = { usa_rev_str = num_deployed_planes_with_type@strike_bomber_equipment }
	#			add_to_variable = { USA_revitalize_the_airforce_bombers = usa_rev_str }
	#
	#			set_variable = { usa_rev_pat = num_deployed_planes_with_type@patrol_equipment }
	#			add_to_variable = { USA_revitalize_the_airforce_bombers = usa_rev_pat }
	#		}
	#	}
	}
	on_monthly_USA = {
		effect = {
			if = {
				limit = {
					has_war = yes
					NOT = {
						has_country_flag = ai_raids_active
					}
					NOT = {
						has_country_flag = ai_raids_inactive
					}
				}
				set_country_flag = ai_raids_active
			}
			if = {
				limit = {
					has_war = yes
					has_country_flag = {
						flag = ai_raids_active
						days > 175
					}
					NOT = {
						has_country_flag = ai_raids_inactive
					}
				}
				clr_country_flag = ai_raids_active
				set_country_flag = {
					flag = ai_raids_inactive
					days = 60
					value = 1
				}
			}
		}
	}
	on_monthly_ENG = {
		effect = {
			if = {
				limit = {
					has_war = yes
					NOT = {
						has_country_flag = ai_raids_active
					}
					NOT = {
						has_country_flag = ai_raids_inactive
					}
				}
				set_country_flag = ai_raids_active
			}
			if = {
				limit = {
					has_war = yes
					has_country_flag = {
						flag = ai_raids_active
						days > 175
					}
					NOT = {
						has_country_flag = ai_raids_inactive
					}
				}
				clr_country_flag = ai_raids_active
				set_country_flag = {
					flag = ai_raids_inactive
					days = 60
					value = 1
				}
			}
		}
	}
	on_weekly_GER = {
		effect = {
			if = {
				limit = {
					has_war = yes
					WA_battle_of_britain = yes
					NOT = {
						has_country_flag = ai_raids_active
					}
				}
				set_country_flag = ai_raids_active
				clr_country_flag = ai_raids_inactive
			}
			if = {
				limit = {
					has_war = yes
					WA_battle_of_britain = no
					NOT = {
						has_country_flag = ai_raids_inactive
					}
				}
				clr_country_flag = ai_raids_active
				set_country_flag = ai_raids_inactive
			}
		}
	}
	on_weekly_FIN = {
		effect = {
			set_variable = { FIN_parliament_shift = 0 }
			set_variable = { FIN_public_shift = 0 }
			if = {
				limit = { has_country_flag = FIN_curfew_flag }
				add_to_variable = { FIN_public_shift = -0.2 }
			}
			if = {
				limit = { has_war = yes }
				set_temp_variable = { temp_losses = casualties_k }
				divide_temp_variable = { temp_losses = 10 }
				round_temp_variable = temp_losses
				divide_temp_variable = { temp_losses = 10 }
				multiply_temp_variable = { temp_losses = -1 }
				add_to_variable = { FIN_public_shift = temp_losses }
			}
			if = {
				limit = { has_war = no }
				add_to_variable = { FIN_public_shift = 0.2 }
				add_to_variable = { FIN_parliament_shift = 0.1 }
			}
			set_variable = { FIN_internal_faction_effect_input = FIN_public_shift }
			FIN_change_public_trust_effect = yes
			set_variable = { FIN_internal_faction_effect_input = FIN_parliament_shift }
			FIN_change_parliament_trust_effect = yes
		}
	}
	on_daily_FIN = {
		# Finland Winter War calculation
		effect = {
			if = {
				limit = { has_global_flag = WA_winter_war_flag }
				FIN = {
					set_variable = { FIN_winter_war_exhaustion_variable = casualties_k }
					clamp_variable = {
						var = FIN_winter_war_exhaustion_variable
						max = 100
					}
					round_variable = FIN_winter_war_exhaustion_variable
					set_temp_variable = { temp_exhaustion = FIN_winter_war_exhaustion_variable }
					divide_temp_variable = { temp_exhaustion = 100 }

					set_variable = { FIN_winter_war_fort_variable = 1}
					subtract_from_variable = { FIN_winter_war_fort_variable = temp_exhaustion }
					multiply_variable = { FIN_winter_war_fort_variable = 0.2 } 				# Min
					set_temp_variable = { lerp_max = -1 } 								# Max
					multiply_temp_variable = { lerp_max = temp_exhaustion }
					add_to_variable = { FIN_winter_war_fort_variable = lerp_max}

					set_variable = { FIN_winter_war_attack_variable = 1}
					subtract_from_variable = { FIN_winter_war_attack_variable = temp_exhaustion }
					multiply_variable = { FIN_winter_war_attack_variable = 0 } 				# Min
					set_temp_variable = { lerp_max = -0.5 } 								# Max
					multiply_temp_variable = { lerp_max = temp_exhaustion }
					add_to_variable = { FIN_winter_war_attack_variable = lerp_max}

					set_variable = { FIN_winter_war_core_defence_variable = 1}
					subtract_from_variable = { FIN_winter_war_core_defence_variable = temp_exhaustion }
					multiply_variable = { FIN_winter_war_core_defence_variable = 0 } 				# Min
					set_temp_variable = { lerp_max = -0.5 }								# Max
					multiply_temp_variable = { lerp_max = temp_exhaustion }
					add_to_variable = { FIN_winter_war_core_defence_variable = lerp_max}
				}
			}
		}
	}

	on_declare_war = {
		#effect = {
		#	if = {
		#		limit = {
		#			FROM = {
		#				tag = SOV
		#				has_war_with = FIN
		#				NOT = {
		#					any_enemy_country = {
		#						is_major = yes
		#					}
		#				}
		#			}
		#			OR = {
		#				FIN = { is_in_faction = no }
		#				FIN = { is_faction_leader = yes }
		#			}
		#			146 = { is_owned_by = FIN }
		#		}
		#	}
		#	add_timed_idea = {
		#		idea = SOV_winter_war_offensive
		#		days = 240
		#	}
		#}
		effect = {
			if = {
				limit = {
					FROM = {
						tag = USA
						has_country_flag = end_mobilization
					}
				}
				FROM = {
					clr_country_flag = end_mobilization
				}
			}
			else_if = {
				limit = {
					tag = USA
					has_country_flag = end_mobilization
				}
				clr_country_flag = end_mobilization
			}
		}
	}

	on_war_relation_added = {
		#effect = {
		#	if = {
		#		limit = {
		#			tag = ENG
		#			is_ai = no
		#			any_other_country = {
		#				is_ai = no
		#			}
		#			NOT = { has_country_flag = ENG_colonies_annexed }
		#		}
		#		hidden_effect = {
		#			set_country_flag = ENG_colonies_annexed
		#		}
		#		annex_country = { target = UKO }
		#		annex_country = { target = UKE }
		#		annex_country = { target = UKN }
		#		annex_country = { target = UKT }
		#		annex_country = { target = UKM }
		#		add_equipment_to_stockpile = { type = eng_inf_1 amount = 11800 producer = ENG }
		#		add_equipment_to_stockpile = { type = support_equipment_1 amount = 700 producer = ENG }
		#	}
		#	if = {
		#		limit = {
		#			tag = ITA
		#			is_ai = no
		#			any_other_country = {
		#				is_ai = no
		#			}
		#			NOT = { has_country_flag = ITA_colonies_annexed }
		#		}
		#		hidden_effect = {
		#			set_country_flag = ITA_colonies_annexed
		#		}
		#		ITL = {
		#			every_unit_leader = {
		#				set_nationality = ITA
		#			}
		#		}
		#		annex_country = { target = ITL transfer_troops = yes }
		#		annex_country = { target = ITS transfer_troops = yes }
		#		add_equipment_to_stockpile = { type = ita_inf_0 amount = 1900 producer = ITL }
		#	}
		#}
		effect = {
			if = {
				limit = {
					is_historical_focus_on = yes
					tag = GER
					FROM = {
						tag = FRA
						num_of_military_factories < 170
						is_ai = no
					}
					date > 1939.8.1
				}
				FRA = {
					set_variable = { num_mils = num_of_military_factories }
					add_to_variable = { num_mils = -180 }
					multiply_variable = { num_mils = -1 }
					set_country_flag = FRA_mills_failsafe
				}
			}
			if = {
				limit = {
					is_historical_focus_on = yes
					tag = GER
					FROM = {
						tag = FRA
						is_ai = no
					}
					date > 1939.8.1
				}
				FRA = {
					set_variable = { num_civs = 0 }
					every_state = {
						limit = {
							is_core_of = FRA
						}
						add_to_temp_array = { temp_civs = industrial_complex_level }
						# log = "Current industrial_complex_level: [?industrial_complex_level]."
					}
					for_each_loop = {
						array = temp_civs
						value = v
						add_to_variable = { num_civs = v }
						# log = "Current v: [?v]"
						# log = "Current num_civs: [?num_civs]"
					}
					if = {
						limit = {
							check_variable = { num_civs < 165 }
						}
						add_to_variable = { num_civs = -175 }
						multiply_variable = { num_civs = -1 }
						set_country_flag = FRA_civs_failsafe
					}
				}
			}
			if = {
				limit = {
					is_historical_focus_on = yes
					tag = GER
					FROM = {
						tag = FRA
						is_ai = no
					}
					date > 1939.8.1
				}
				FRA = {
					set_variable = { inf_eq = num_equipment@infantry_equipment }
					add_to_variable = { inf_eq = num_equipment_in_armies@infantry_equipment }
					if = {
						limit = {
							check_variable = {
								inf_eq < 90000
							}
						}
						add_to_variable = { inf_eq = -100000 }
						multiply_variable = { inf_eq = -1 }
						set_country_flag = FRA_inf_eq_failsafe
					}
					set_variable = { hv_inf_eq = num_equipment@heavy_infantry_equipment }
					add_to_variable = { hv_inf_eq = num_equipment_in_armies@heavy_infantry_equipment }
					if = {
						limit = {
							check_variable = {
								hv_inf_eq < 36000
							}
						}
						add_to_variable = { hv_inf_eq = -40000 }
						multiply_variable = { hv_inf_eq = -1 }
						set_country_flag = FRA_hv_inf_eq_failsafe
					}
					set_variable = { supp_eq = num_equipment@support_equipment }
					add_to_variable = { supp_eq = num_equipment_in_armies@support_equipment }
					if = {
						limit = {
							check_variable = {
								supp_eq < 45000
							}
						}
						add_to_variable = { supp_eq = -50000 }
						multiply_variable = { supp_eq = -1 }
						set_country_flag = FRA_supp_eq_failsafe
					}
					set_variable = { truck_eq = num_equipment@motorized_equipment }
					add_to_variable = { truck_eq = num_equipment_in_armies@motorized_equipment }
					if = {
						limit = {
							check_variable = {
								truck_eq < 15000
							}
						}
						add_to_variable = { truck_eq = -17000 }
						multiply_variable = { truck_eq = -1 }
						set_country_flag = FRA_truck_eq_failsafe
					}
					set_variable = { art_eq = num_equipment@artillery_equipment }
					add_to_variable = { art_eq = num_equipment_in_armies@artillery_equipment }
					if = {
						limit = {
							check_variable = {
								art_eq < 2250
							}
						}
						add_to_variable = { art_eq = -2500 }
						multiply_variable = { art_eq = -1 }
						set_country_flag = FRA_art_eq_failsafe
					}
					set_variable = { train_eq = num_equipment@train_equipment }
					add_to_variable = { train_eq = num_equipment_in_armies@train_equipment }
					if = {
						limit = {
							check_variable = {
								train_eq < 720
							}
						}
						add_to_variable = { train_eq = -800 }
						multiply_variable = { train_eq = -1 }
						set_country_flag = FRA_train_eq_failsafe
					}
				}
			}
		}
		effect = {
			if = {
				limit = {
					ROOT = {
						tag = GER
						NOT = {
							is_embargoed_by = SOV
						}
					}
					FROM = {
						tag = TUR
					}
					SOV = {
						exists = yes
						has_capitulated = no
						NOT = {
							has_war_with = FROM
						}
						NOT = {
							has_war_with = ROOT
						}
						NOT = {
							is_in_faction_with = ROOT
						}
					}
				}
				SOV = {
					send_embargo = ROOT
					if = {
						limit = {
							has_idea = SOV_molotov_ribbentrop_pact
						}
					}
					remove_ideas = SOV_molotov_ribbentrop_pact
				}
				ROOT = {
					if = {
						limit = {
							has_idea = SOV_soviet_german_trade_agreement
						}
						remove_ideas = SOV_soviet_german_trade_agreement
					}
				}
			}
		}
	}

	on_join_faction = {
		effect = {
			if = {
				limit = {
					FROM = {
						original_tag = GER
					}
					SWE = {
						has_opinion_modifier = swedish_resource_monopoly
					}
				}
				SWE = {
					remove_opinion_modifier = {
						target = ROOT
						modifier = embargo
					}
				}
			}
		}
		effect = {
			if = {
				limit = {
					ROOT = {
						original_tag = TUR
					}
				}
				every_country = {
					limit = {
						is_in_faction_with = TUR
					}
					TUR = {
						remove_opinion_modifier = {
							target = PREV
							modifier = embargo
						}
					}
				}
			}
		}
	}

	on_offer_join_faction = {
		effect = {
			if = {
				limit = {
					ROOT = {
						original_tag = GER
					}
					SWE = {
						has_opinion_modifier = swedish_resource_monopoly
					}
				}
				SWE = {
					remove_opinion_modifier = {
						target = FROM
						modifier = embargo
					}
				}
			}
		}
		effect = {
			if = {
				limit = {
					FROM = {
						original_tag = TUR
					}
				}
				every_country = {
					limit = {
						is_in_faction_with = TUR
					}
					TUR = {
						remove_opinion_modifier = {
							target = PREV
							modifier = embargo
						}
					}
				}
			}
		}
	}

	on_unit_leader_created = {
		effect = {
			if = {
				limit = {
					FROM = {
						tag = ITA
					}
				}
				ROOT = {
					if = {
						limit = {
							NOT = {
								has_trait = incompetent_unit_leader
							}
						}
						add_unit_leader_trait = inadequate_army_trait
					}
				}
			}
		}
	}

	on_unit_leader_promote_from_ranks_veteran = {
		effect = {
			if = {
				limit = {
					FROM = {
						tag = ITA
					}
				}
				ROOT = {
					if = {
						limit = {
							NOT = {
								has_trait = incompetent_unit_leader
							}
						}
						add_unit_leader_trait = inadequate_army_trait
					}
				}
			}
		}
	}

	on_unit_leader_promote_from_ranks_green = {
		effect = {
			if = {
				limit = {
					FROM = {
						tag = ITA
					}
				}
				ROOT = {
					if = {
						limit = {
							NOT = {
								has_trait = incompetent_unit_leader
							}
						}
						add_unit_leader_trait = inadequate_army_trait
					}
				}
			}
		}
	}
}
